<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
     <title>BPA</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" /> 
    <link rel="stylesheet" href="css/bpa_style.css" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Maven+Pro" rel="stylesheet">
    <link rel="stylesheet" href="css/perfect-scrollbar.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <link rel="shortcut icon" href="img/pnw.ico" type="image/x-icon">
    
    <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script src="js/perfect-scrollbar.js"></script>
    
   
</head>
<body>
		<button id="collapse" onclick="collapse()">
			<i class="fa fa-chevron-left" id ="collapse-arrow" aria-hidden="true"></i>
		</button>
		<div id="infoPanel">
			<div id="top">
			<h1>Bonneville Power Administration</h1>
			<img src="img/renewable.png" id="image2" style="display:inline-block;">
			<div id="buttons">
				<div class="dropdown">
  					<button class="dropbtn"><b id="bar2">Select Class</b><p id="arrow">&#9660;</p></button>
  					<div class="dropdown-content">
   						 <button type="button" id="but1" onclick="wind()" class="species" style="background:rgba(242, 242, 242, 0.8);">Wind</button>
						 <button type="button" id="but2" onclick="solar()" class="species">Solar</button>
						 <button type="button" id="but3" onclick="geothermal()" class="species">Geothermal</button>
 				   </div>
				</div>
			</div>
			<div id="leg_1" style="display:unset;">
				<h2 id="title" style="display:block; width:280px; white-space:normal;">Wind Energy</h2><img src="img/icons/wind.png" id="image" style="display:inline-block; float:right;">
				<div><b id="leg1_block" style="background:#08519c; border-left:black 2px solid; border-right:black 2px solid; border-top:black 2px solid;"></b><p>&nbsp</p><p id="leg1" style="margin-left:5px;">Class 7</p><br/></div>
				<div><b id="leg2_block" style="background:#3182bd; border-left:black 2px solid; border-right:black 2px solid;"></b><p>&nbsp</p><p id="leg2" style="margin-left:5px;">Class 6</p><br/></div>
				<div><b id="leg3_block" style="background:#6baed6; border-left:black 2px solid; border-right:black 2px solid;"></b><p>&nbsp</p><p id="leg2" style="margin-left:5px;">Class 5</p><br/></div>
				<div><b id="leg4_block" style="background:#9ecae1; border-left:black 2px solid; border-right:black 2px solid;"></b><p>&nbsp</p><p id="leg2" style="margin-left:5px;">Class 4</p><br/></div>
				<div><b id="leg5_block" style="background:#c6dbef; border-left:black 2px solid; border-right:black 2px solid; border-bottom:black 2px solid;"></b><p>&nbsp</p><p id="leg3" style="margin-left:5px;">Class 3</p></div><br/>
				<div><b id="leg6_block" style="background:#eff3ff; border-left:black 2px solid; border-right:black 2px solid; border-bottom:black 2px solid;"></b><p>&nbsp</p><p id="leg3" style="margin-left:5px;">Class 2</p></div><br/>
				<br/>
				<p id="description" style="font-weight:bold; text-align:justify; white-space:normal; padding-left:0px; width:280px; display:block; position:relative;">Wind energy potential class. Higher classes correspond with greater potential.</p>
			</div>	
			<div id="leg_2" style="display:none;">
				<h2 id="title" style="display:block; width:280px; white-space:normal;">Solar Power</h2><img src="img/icons/solar.png" id="image" style="display:inline-block; float:right;">
				<div><b id="leg1_block" style="background:#b30000; border-left:black 2px solid; border-right:black 2px solid; border-top:black 2px solid;"></b><p>&nbsp</p><p id="leg1" style="margin-left:5px;">5.5+</p><br/></div>
				<div><b id="leg2_block" style="background:#e34a33; border-left:black 2px solid; border-right:black 2px solid;"></b><p>&nbsp</p><p id="leg2" style="margin-left:5px;">5 - 5.5</p><br/></div>
				<div><b id="leg3_block" style="background:#fc8d59; border-left:black 2px solid; border-right:black 2px solid;"></b><p>&nbsp</p><p id="leg2" style="margin-left:5px;">4.5 - 5</p><br/></div>
				<div><b id="leg4_block" style="background:#fdcc8a; border-left:black 2px solid; border-right:black 2px solid;"></b><p>&nbsp</p><p id="leg2" style="margin-left:5px;">4 - 4.5</p><br/></div>
				<div><b id="leg5_block" style="background:#fef0d9; border-left:black 2px solid; border-right:black 2px solid; border-bottom:black 2px solid;"></b><p>&nbsp</p><p id="leg3" style="margin-left:5px;">Less than 4</p><br/></div>
				<br/>
				<p id="description" style="font-weight:bold; text-align:justify; white-space:normal; padding-left:0px; width:280px; display:block; position:relative;">Annual solar irradiance in kWh/m2/day. Higher values correspond with greater solar potential.</p>
			</div>	
			<div id="leg_3" style="display:none;">
				<h2 id="title" style="display:block; width:280px; white-space:normal;">Geothermal Energy</h2><img src="img/icons/geothermal.png" id="image" style="display:inline-block; float:right;">
				<div><b id="leg1_block" style="background:#4b4b34; border-left:black 2px solid; border-right:black 2px solid; border-top:black 2px solid;"></b><p>&nbsp</p><p id="leg1" style="margin-left:5px;">Class 1</p><br/></div>
				<div><b id="leg2_block" style="background:#787854; border-left:black 2px solid; border-right:black 2px solid;"></b><p>&nbsp</p><p id="leg2" style="margin-left:5px;">Class 2</p><br/></div>
				<div><b id="leg3_block" style="background:#abab87; border-left:black 2px solid; border-right:black 2px solid;"></b><p>&nbsp</p><p id="leg2" style="margin-left:5px;">Class 3</p><br/></div>
				<div><b id="leg4_block" style="background:#cbcbb4; border-left:black 2px solid; border-right:black 2px solid;"></b><p>&nbsp</p><p id="leg2" style="margin-left:5px;">Class 4</p><br/></div>
				<div><b id="leg6_block" style="background:#ebebe0; border-left:black 2px solid; border-right:black 2px solid; border-bottom:black 2px solid;"></b><p>&nbsp</p><p id="leg3" style="margin-left:5px;">Class 5</p></div><br/>
				<br/>
				<p id="description" style="font-weight:bold; text-align:justify; white-space:normal; padding-left:0px; width:280px; display:block; position:relative;">Geothermal energy potential class. Lower classes correspond with greater potential.</p>
			</div>
			</div>
			<div id="attribution">
				<div id="text" style="margin-top:10px;">
					<p3>Urban areas are comprised as a densely settled core of census tracts and/or census blocks that meet minimum population density requirements, along with adjacent territory containing non-residential urban land uses as well as territory with low population density included to link outlying densely settled territory with the densely settled core. There are two types of urban areas:</p3>
					<b2>Urbanized Areas</b2>
					<p3>include areas with at least 50,000 people,</p3>
					<b2>Urban Clusters</b2>
					<p3>include areas between 2,500 and 50,000 people.</p3>				
					<b2>Rural Areas</b2>
					<p3>encompass all population, housing, and territory not included within an urban area.</p3>			
				</div>
			<div id="pageChange">
				<a href="water_use_index.html" id="arrow" style="display:inline-block;">
					<i class="fa fa-arrow-left" aria-hidden="true" style=""></i>
				</a>
				<a href="water_source_index.html" id="arrow" style="display:inline-block;" target="_blank">
					<i class="fa fa-info-circle" aria-hidden="true" style="padding-left:83px;"></i>
				</a>
				<a href="water_index.html" id="arrow" style="display:inline-block;" target="_blank">
					<i class="fa fa-home" aria-hidden="true" style="padding-left:0;"></i>
				</a>
				<a href="watershed_index.html" id="arrow" style="display:inline-block;">
					<i class="fa fa-arrow-right" aria-hidden="true" style="padding-left:82px;"></i>
				</a>
			</div>
			</div>
		</div>
    	<div id="map" style="width: 100%; height: 100%;"></div>
<script>
	
	var collapsed = false;
    function collapse(){
    	if (collapsed == false){
    		document.getElementById("infoPanel").style.transition = "display 2s";
    		document.getElementById("infoPanel").style.display = "none";
    		document.getElementById("collapse").style.left = '0px';
    		document.getElementById("collapse").style.paddingLeft = '2px';
    		document.getElementById("collapse-arrow").className = "fa fa-chevron-right";
    		collapsed = true;
    	} else{
    		document.getElementById("infoPanel").style.display = "unset";
    		document.getElementById("collapse").style.left = '320px';
    		document.getElementById("collapse").style.paddingLeft = '0px';
    		document.getElementById("collapse-arrow").className = "fa fa-chevron-left";
    		collapsed = false;
    	}
    	
    }
    
    L.TopoJSON = L.GeoJSON.extend({  
  		addData: function(jsonData) {    
    		if (jsonData.type === 'Topology') {
      			for (key in jsonData.objects) {
       			 geojson = topojson.feature(jsonData, jsonData.objects[key]);
       			 L.GeoJSON.prototype.addData.call(this, geojson);
      		}
    	}    
    	else {
      		L.GeoJSON.prototype.addData.call(this, jsonData);
    		}
  		}  
	});
	//initialize map
	var map = L.map('map', {center: [45.56, -119.75], zoom: 7, zoomControl:false});
	///////////////////////make zoom level correspond to browser size////////////////////////////////
	window.addEventListener('load', function(event){
    	var width = document.documentElement.clientWidth;
    	if (width < 1500 && width > 800) {
        	map.setView(new L.LatLng(45.56, -121.75), 6); 
    		}  else if (width > 1501) {
        	map.setZoom(7);
        	} else {
        	map.setZoom(5);
        	}
	});
	////////////////////////////////add tiled basemap////////////////////////////////
var Esri_WorldTerrain = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}', {
		attribution: 'Tiles &copy; Esri &mdash; Source: USGS, Esri, TANA, DeLorme, and NPS',
		maxZoom:10,
		minZoom:5,
		opacity:1
	}).addTo(map);

var pnwCover = L.tileLayer.wms('http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/wms', {
		layers: 'baldricg_PNW_ATLAS:pnw_outline2_black',
        format: 'image/png',
		maxZoom:10,
		minZoom:5,
		opacity:0.5,
		transparent:true,
	}).addTo(map);

	
var label = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_only_labels/{z}/{x}/{y}@2x.png', {
		attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
		subdomains: 'abcd',
		maxZoom:10,
		minZoom:5,
		tileSize:256,
		bounds:[
			new L.LatLng(49.56,-125.25),
			new L.LatLng(40.5,-111.5)
		],
		pane:'labels'
	});	
	
	
	map.createPane('labels');
	map.getPane('labels').style.pointerEvents = 'none';
	map.getPane('labels').style.zIndex = 650;
	label.addTo(map);
	
	map.createPane('tooltip');
	map.getPane('tooltip').style.zIndex = 700;
	//changes depending on which data type is selected, initial value is for County Employment
	var data = 0;
	var water = 0;
	//used with DATA variable to select data type corresponding to each button. Odd numbered buttons correspond to state-level data
	var buttonNumber = ['but1','but2','but3','but4','but5','but6','but7','but8','but9'];
	

    ///////////////////////////////////////////////////////////////////////////////////////	
  	/*var info = L.control();

	info.onAdd = function (map) {
    	this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
    	this.update();
    	return this._div;
	};
	
	info.update = function (feature) {
		function nullFinder(prop) {
			if (prop == null)
				{return 0;}
			else if (isNaN(prop) == true)
				{return 0;}
			else {return prop;}
		}
		if (data == 0){
   		this._div.innerHTML = (feature ?
        	'<h3 style="margin:0; display:inline-block;">'+ feature.NAME +'</h3><br/>' + '<p style="display:inline;">' + feature.text_class + '</p>'
       		:'<p style="display:inline;">Hover over Map</p>');
		}
		else if (data == 1){	
			this._div.innerHTML = (feature ?
        	'<h3 style="margin:0; display:inline-block;">'+ feature.NAME +'</h3><br/>' + '<p style="display:inline;">' + feature.text_class + '</br></p><p style="display:inline; font-weight:bold;">$' + nullFinder(feature.income_cap) + '</p><p style="display:inline"> Income per Cap.</p>'
       		:'<p style="display:inline;">Hover over Map</p>');
			}	
		else {	
			this._div.innerHTML = (feature ?
        	'<h3 style="margin:0; display:inline-block;">'+ feature.NAME +'</h3><br/>' + '<p style="display:inline;">' + feature.text_class + '</br></p><p style="display:inline; font-weight:bold;">' + nullFinder(((feature.unemployed/feature.labor_forc)*100).toFixed(2)) + '%</p><p style="display:inline"> Unemployed</p>'
       		:'<p style="display:inline;">Hover over Map</p>');
       	}
	};

	info.addTo(map);*/
    
    ////////////////////////////////initial geoJSON styling////////////////////////////////

	var data = 0;
	var classButtonType = 'but1';
	
	function damSize(e){
		return e > 1000 ? 12:
			e > 500 ? 10:
			e > 250 ? 8:
			e > 50 ? 6:
				4; 
	}
	
	function damHighlight(e) {
		 var layer = e.target;
		 layer.setStyle({
        	fillColor: '#ffffff'
    	 });
		}
	//reset feature function (after highlight)
	function resetDamHighlight(e) {
		var layer = e.target;
		 layer.setStyle({
			fillColor: '#000000'
    	 });
	}
	
	function pointStyle(feature, latlng){
		return L.circleMarker(latlng, {
    				color:'#ffffff',
    				fillColor: '#000000',
    				radius: damSize(feature.properties.Total_MW),
    				opacity: 1,
    				fillOpacity: 1,
    				weight: 1.5,
    			})
    		}
	
	var dams;
		
	function damFilter(feature) {
			if ( data == 0){
				return feature.properties.PrimSource == "wind" ? true:
					false;
			}
			if ( data == 1){
				return feature.properties.PrimSource == "solar" ? true:
					false;
			}
			if ( data == 2){
				return feature.properties.PrimSource == "geothermal" ? true:
					false;
			}
    	}	
	
    function addDams(){
    	dams = $.getJSON("assets/pnw_power_plants.geojson", function(data){
        	dams = L.geoJson(data, {
        		pointToLayer: pointStyle,
    			onEachFeature: function(feature, featureLayer) {
        			featureLayer.bindTooltip('<h3 style="display:inline;">' + feature.properties.Plant_Name + '</h3><br/><p style="display:inline;">Operator:&nbsp' + feature.properties.Utility_Na + '&nbsp<br/>Type:&nbsp' + feature.properties.PrimSource + '<br/>Capacity:&nbsp' + feature.properties.Total_MW + ' MW</p>', {className: 'label_tooltip', pane:'tooltip'});
        			featureLayer.on({
        				mouseover: damHighlight,
        				mouseout: resetDamHighlight
   					});
        		},
    			filter:damFilter
        	}).addTo(map);
   	 	});
	}
	
	addDams();
	//////////////////////////////////////////////////////////////////////////////
	var windPotential = L.tileLayer.wms('http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/wms', {
		layers: 'baldricg_PNW_ATLAS:wind_potential',
        format: 'image/png',
		maxZoom:10,
		minZoom:5,
		opacity:0.9,
		transparent:true,
	}).addTo(map);
	//////////////////////////////////////////////////////////////////////////////
	const geo = new L.TopoJSON();

	$.getJSON('assets/geothermal_potential.json')
  		.done(addGeoTopoData);

	function addGeoTopoData(topoData) {  
  		geo.addData(topoData);
  		geo.eachLayer(handleGeoLayer);
	}
	
	function setGeoColor(density){
        return density == 1 ? '#4b4b34' :
            density == 2 ? '#787854' :
            density == 3 ? '#abab87' :
            density == 4 ? '#cbcbb4' :
            density == 5 ? '#ebebe0' :
                '#ffffff';
    	}
	
	function handleGeoLayer(layer){
        layer.setStyle({
          	fillColor: setGeoColor(layer.feature.properties.CLASS),
            fillOpacity: 0.7,
            weight: 1.5,
            opacity: 0.5,
            color: setGeoColor(layer.feature.properties.CLASS),
        });
    }

	
	//////////////////////////////////////////////////////////////////////////////
	const solarIrr = new L.TopoJSON();

	$.getJSON('assets/solar_irradiance.json')
  		.done(addTopoData);

	function addTopoData(topoData) {  
  		solarIrr.addData(topoData);
  		solarIrr.eachLayer(handleSolarLayer);
	}
	
	function setSolarColor(density){
        return density > 5.5 ? '#b30000' :
            density > 5 ? '#e34a33' :
            density > 4.5 ? '#fc8d59' :
            density > 4 ? '#fdcc8a' :
                '#fef0d9';
    	}
	
	function handleSolarLayer(layer){
        layer.setStyle({
          fillColor: setSolarColor(layer.feature.properties.ANN_DNI),
            	fillOpacity: 0.7,
            	weight: 1.5,
            	opacity: 0,
            	color: setSolarColor(layer.feature.properties.ANN_DNI),
        });
    }
    
	var legType = 'leg_1';
	
	//////////////////////////////////////////////////////////////////////////////
    function wind(){
    	data = 0;
    	document.getElementById(classButtonType).style.background = "rgba(242, 242, 242, 0.2)";
    	classButtonType = 'but1';
    	document.getElementById(classButtonType).style.background = "rgba(242, 242, 242, 1)";
    	document.getElementById(legType).style.display = "none";
    	legType = 'leg_1';
    	document.getElementById(legType).style.display = "unset";
    	document.getElementById('bar2').innerHTML = "Wind";
    	map.removeLayer(dams);
    	map.removeLayer(geo);
    	map.removeLayer(solarIrr);
    	windPotential.addTo(map);
    	addDams();
    }
    function solar(){
    	data = 1;
    	document.getElementById(classButtonType).style.background = "rgba(242, 242, 242, 0.2)";
    	classButtonType = 'but2';
    	document.getElementById(classButtonType).style.background = "rgba(242, 242, 242, 1)";
    	document.getElementById(legType).style.display = "none";
    	legType = 'leg_2';
    	document.getElementById(legType).style.display = "unset";
    	document.getElementById('bar2').innerHTML = "Solar";
    	map.removeLayer(dams);
    	map.removeLayer(windPotential);
    	map.removeLayer(geo);
    	solarIrr.addTo(map);
    	addDams();
    }
    function geothermal(){
    	data = 2;
    	document.getElementById(classButtonType).style.background = "rgba(242, 242, 242, 0.2)";
    	classButtonType = 'but3';
    	document.getElementById(classButtonType).style.background = "rgba(242, 242, 242, 1)";
    	document.getElementById(legType).style.display = "none";
    	legType = 'leg_3';
    	document.getElementById(legType).style.display = "unset";
    	document.getElementById('bar2').innerHTML = "Geothermal";
    	map.removeLayer(dams);
    	map.removeLayer(windPotential);
    	map.removeLayer(solarIrr);
    	geo.addTo(map);
    	addDams();
    }
    
	///////////////////////////////add outline layers////////////////////////////////
	function pnwStatesStyle(){
	return{
		opacity: 1,
		color:'#666666',
		fillOpacity:0	,
		fillColor:'#404040',
		weight:1
		};
	}
     var pnwStates = $.getJSON("assets/pnw_states.geojson", function(data){
        pnwStates = L.geoJson(data, {
        	style:pnwStatesStyle,
        	interactive: false
        }).addTo(map);
    });
	//////////////////////////////////////////////////////////////////////////////

   	//add zoom control
    new L.Control.Zoom({ position: 'topright' }).addTo(map);
    
    //remove leaflet attribution
	document.getElementsByClassName("leaflet-control-attribution")[0].style.visibility = "hidden";
	
	//add scrolling capabilities to text box
     var container = document.getElementById('text');
		Ps.initialize(container);
	
	//update text box to be correct size
	var minHeight = 50; // Define a minimum height for the middle div

	function resizeMiddle() {
    var h = $('body').height() - $('#top').height() - 65;
    		h = h > minHeight ? h : minHeight;
   	 	$('#attribution').height(h);
	}

	$(document).ready(resizeMiddle);
	$(window).resize(resizeMiddle);
	
    //remove standard leaflet attribution
    

</script>
</body>
</html>
