<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
     <title>Watersheds</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" /> 
    <link rel="stylesheet" href="css/watershed_style.css" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Maven+Pro" rel="stylesheet">
    <link rel="stylesheet" href="css/perfect-scrollbar.css" />
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <link rel="shortcut icon" href="img/pnw.ico" type="image/x-icon">
    
    <meta property="og:title" content="Atlas of the Pacific Northwest: Watersheds" />
    <meta property="og:url" content="https://rawgit.com/osulp/PNWatlas/master/water/watershed.html" />
    <meta property="og:description" content="Watershed maps of the Pacific Northwest."/>
    
    <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://unpkg.com/leaflet.vectorgrid@latest/dist/Leaflet.VectorGrid.bundled.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script src="js/perfect-scrollbar.js"></script>
    <script type="text/javascript" src="../js/clickFunction.js"></script>
    
    <link rel="stylesheet" href="../css/introjs.css" />
    <script src="../js/intro.js"></script>
   
</head>
<body>
		<button id="collapse" onclick="collapse()">
			<i class="fa fa-chevron-left" id ="collapse-arrow" aria-hidden="true"></i>
		</button>
		<div id="infoPanel">
			<div id="top">
				<h1>Watersheds</h1>
				<br/>
				<img src="img/water_icon.png" id="titleImageCircle" style="display:inline-block;">
				<div id="buttons" data-step="1" data-intro="Use the dropdown menu to select different scales for display.">
					<div class="dropdown">
						<button class="dropbtn"><b id="dataType">Select Scale</b><p id="arrow">&#9660;</p></button>
						<div class="dropdown-content">
							 <button type="button" id="but1" class="selection" style="background:rgba(242, 242, 242, 0.8);">Regional</button>
							 <button type="button" id="but2" class="selection">Subregional</button>
							 <button type="button" id="but3" class="selection">Local</button>
					   </div>
					</div>
				</div>
			</div>
			<br/>
			<div id="attribution">
				<div id="text" data-step="2" data-intro="Select a watershed to view information about that watershed.">
					<h2 id="title" style="width:280px; white-space:normal; text-align:left; font-size:30px; margin-bottom:10px; margin-top:10px;">Select a Watershed</h2>
					<div id="watershed_desc" style="display:none;">
						<h2 style="display:inline; width:200px; white-space:normal;">Area:</h2>
						<h2 id="area" style="display:inline; width:200px; white-space:normal;"></h2><br/>
						<h2 id="dams_title" style="display:inline; width:200px; white-space:normal;">Large Dams<sup class="tooltip">?<span class="tooltiptext">Dams higher than 50 ft. or capacity greater than 5000 acre ft.</span></sup>:</h2>
						<h2 id="dams" style="display:inline; width:200px; white-space:normal;"></h2><br/>
						<h2 style="display:inline; width:200px; white-space:normal;">Population:</h2>
						<h2 id="population" style="display:inline; width:200px; white-space:normal;"></h2><br/>
						<h2 style="display:inline; width:200px; white-space:normal;">States/Provinces<sup class="tooltip">?<span class="tooltiptext">States and Provinces intersected by the river basin</span></sup>:</h2>
						<h2 id="states" style="display:inline; width:200px; white-space:normal;"></h2><br/>
						<h2 style="display:inline; width:200px; white-space:normal;">Counties<sup class="tooltip">?<span class="tooltiptext">Number of Counties intersected by the river basin. BC is one county.</span></sup>:</h2>
						<h2 id="counties" style="display:inline; width:200px; white-space:normal;"></h2><br/>
						<h2 style="display:inline; width:200px; white-space:normal;">Cities<sup class="tooltip">?<span class="tooltiptext">Incorporated Cities and selected Census Designated Places with population over 1 person</span></sup>:</h2>
						<h2 id="cities" style="display:inline; width:200px; white-space:normal;"></h2><br/>
					</div>
					<br/>
					<label class="switch" data-step="3" data-intro="Use the slider to toggle the display of politial borders.">
							<input name="checkbox_name" id="checkbox_id" type="checkbox" value="check" onclick="borders()" autocomplete="off">
							<span class="slider"></span>
					</label>
					<p style="padding-left:5px; padding-top:6px; font-weight:bold;">Toggle Political Borders</p><br/>
					<div id="watershed_legend" style="display:none">
						<br/><br/>
						<div style="height:32px;"><b id="leg1_block" style="background:#80bfff; border-left:black 2px solid; border-right:black 2px solid; border-top:black 2px solid;"></b><p>&nbsp</p><p id="leg1" style="margin-left:5px;">Lake</p></div>
						<div style="height:32px;"><b id="leg1_block" style="background:#b3daff; border-left:black 2px solid; border-right:black 2px solid; border-bottom:black 2px solid;"></b><p>&nbsp</p><p id="leg1" style="margin-left:5px;">Seasonal Lake</p></div>
						<br/>
						<div style="width:200px; display:inline-block;"><hr style="color:#80bfff; width:52px; float:left; height:4px; background-color:#80bfff; line-height:20px; margin-top:15px; display:inline; border:none;"/><p id="leg1" style="padding-left:5px;">River</p></div>
						<div style="width:200px; display:inline-block;"><hr style="color:#00cc99; width:52px; float:left; height:4px; background-color:#00cc99; line-height:20px; margin-top:15px; display:inline; border:none;"/><p id="leg1" style="padding-left:5px;">Canal</p></div><br/>
						<div style="width:200px; display:inline-block;"><hr style="color:#80bfff; width:52px; float:left; height:4px; background-color:#ffffff; line-height:20px; margin-top:15px; display:inline; border:none; border-top:4px dashed #80bfff;"/><p id="leg1" style="padding-left:5px;">Seasonal River</p></div><br/>
						<br/>
						<div style="height:32px;"><b id="leg1_block" style="background:#d9d9d9; border-left:black 2px solid; border-right:black 2px solid; border-top:black 2px solid;"></b><p>&nbsp</p><p id="leg1" style="margin-left:5px;">Urban Area</p></div>
						<div style="height:32px;"><b id="leg1_block" style="background:#ededdc; border-left:black 2px solid; border-right:black 2px solid; border-bottom:black 2px solid;"></b><p>&nbsp</p><p id="leg1" style="margin-left:5px;">Tribal Land</p></div>
						<br/>
						<div id = "damLegend">
							<h3 style="margin:0; padding:0; font-size:20px;display:inline;">Dam Height in Ft.</h3><br/>
							<div id ="size" style="margin-bottom:10px;"><b class="circle" style="background:#000000; width:17px; height:17px; border: black 1px solid;"></b></div><div id="sizeLabel"><p style="padding-left:36px;">&nbsp301+</p></div><br/>
							<div id ="size" style="margin-bottom:10px;"><b class="circle" style="background:#000000; width:13px; height:13px; border: black 1px solid;"></b></div><div id="sizeLabel"><p style="padding-left:36px;">&nbsp201 - 300</p></div><br/>
							<div id ="size" style="margin-bottom:10px;"><b class="circle" style="background:#000000; width:9px; height:9px; border: black 1px solid;"></b></div><div id="sizeLabel"><p style="padding-left:36px;">&nbsp101 - 200</p></div><br/>
							<div id ="size" style="margin-bottom:10px;"><b class="circle" style="background:#000000; width:6px; height:6px; border: black 1px solid;"></b></div><div id="sizeLabel"><p style="padding-left:36px;">&nbsp26 - 100</p></div><br/>
							<div id ="size" style="margin-bottom:10px;"><b class="circle" style="background:#000000; width:3px; height:3px; border: black 1px solid;"></b></div><div id="sizeLabel"><p style="padding-left:36px;">&nbsp0 - 25</p></div>
						</div>
					</div>
					<br/>
					<!--
					<p3 style="text-align:justify;">Watersheds are independent of political boundaries, which makes watershed management challenging. An upstream water user can be in a different county, or state, or country than a downstream user, and there could be dozens of municipal water users between them. In the mid-20th century, the United States Bureau of Reclamation and Army Corps of Engineers both had a single prevailing strategy for watershed management: build dams. It has taken decades to understand the effects these widespread damming efforts have had on watershed health, not to mention the water conflicts they have created. Nowadays, basin-wide agreements are becoming more commonplace. The Columbia River Treaty was the first, in 1964, and other rivers within the region have followed with agreements of their own. Watershed Councils exist to monitor and advocate for the health of entire watersheds. Their advocacy, as well as tribal groups, have actualized efforts to remove dams throughout the region.</p3>
					-->
				</div>
				<div id="pageChange" data-step="4" data-intro="Use these buttons to view data sources, view other map pages, or share maps on social media.">
					<a href="#sources" id="arrow" style="display:inline-block;" title="Map Sources/Info">
						<i class="fa fa-info-circle" aria-hidden="true" style="padding-left:60px;"></i>
					</a>
					<a href="#link_popup" id="arrow" style="display:inline-block;" title="Other Maps">
						<i class="fa fa-home" aria-hidden="true" style="padding-left:7px;"></i>
					</a>
					<a href="#share" class="share" id="arrow" style="display:inline-block;" title="Share Map">
						<i class="fa fa-share-alt " aria-hidden="true" style="padding-left:7px;"></i>
					</a>
					<a class="share" id="arrow" style="display:inline-block;" href="javascript:void(0);" onclick="javascript:introJs().setOption('showBullets', false).setOption('showStepNumbers', false).setOption('tooltipClass', 'customDefault').start();" title="Map Demo">
						<i class="fa fa-question-circle " aria-hidden="true" style="padding-left:7px;"></i>
					</a>
				</div>
			</div>
		</div>
    	<div id="map" style="width: 100%; height: 100%;" data-step="5" data-intro="This is the main map display. Select watersheds to reveal more information.">
    		<button type="button" class='centerMap' onclick="centerMap()">Center</button>
    	</div>
    	
    	<div id="sources" class="overlay">
			<div class="popup">
				<h2 style="display:inline; font-size:32px;">Sources</h2>
				<a class="close" href="#" style="display:inline;">×</a>
				<hr>
				<div class="content">
					<p2 style="font-size:20px">Geographic Data</p2><br><br/>
                     <div class="source">
                    	<b><p2>Watershed Boundaries: <a href="https://nhd.usgs.gov/wbd.html" target="_blank">USGS</a></p2></b><br>
                    		<p3>Data edited/generalized for readability. Watersheds were joined at each scale.</p3>
                    </div>
                    <div class="source">
                		<b><p2>National Dams: <a href="https://www.sciencebase.gov/catalog/item/581d051ee4b08da350d523db" target="_blank">USGS</a></p2></b><br>
                			<p3>Data from 2006.</p3>
                	</div>
                	<div class="source">
                		<b><p2>Idaho Dams: <a href="https://research.idwr.idaho.gov/gis/GISScripts/metadata.aspx?md=Spatial/DamSafety/dam.shp.xml" target="_blank">Idaho Department of Water Resources</a></p2></b><br>
                			<p3>Data from 2010.</p3>
                	</div>
                	<div class="source">
                		<b><p2>Oregon Dams: <a href="http://spatialdata.oregonexplorer.info/geoportal/details;id=523fed781b444e278e86fd0c63fd7c53" target="_blank">Oregon Water Resources Department</a></p2></b><br>
                			<p3>Data from 2014.</p3>
                	</div>
                	<div class="source">
                		<b><p2>Washington Dams: <a href="https://fortress.wa.gov/ecy/publications/documents/94016.pdf" target="_blank">Washington State Department of Ecology</a></p2></b><br>
                			<p3>Data from 2018. Data had must be requested for use.</p3>
                	</div>
                	<div class="source">
                		<b><p2>Canadian Dams: <a href="https://catalogue.data.gov.bc.ca/dataset/b-c-dams" target="_blank">Natural Resources Canada</a></p2></b><br>
                			<p3>Data from 2017.</p3>
                	</div>
                	<div class="source">
                		<b><p2>American Rivers: <a href="https://www.sciencebase.gov/catalog/item/4fb55df0e4b04cb937751e02" target="_blank">USGS</a></p2></b><br>
                			<p3>Data from 2011.</p3>
                	</div>
                	<div class="source">
                		<b><p2>Canadian Rivers: <a href="http://www.empr.gov.bc.ca/Mining/Geoscience/MapPlace/geoData/Pages/default.aspx" target="_blank">USGS</a></p2></b><br>
                			<p3>Data from 2006.</p3>
                	</div>
                	<div class="source">
                		<b><p2>American Lakes: <a href="https://www.sciencebase.gov/catalog/item/4fb55df0e4b04cb937751e02" target="_blank">USGS</a></p2></b><br>
                		<p3>Data from 2011.</p3>
                	</div>
                	<div class="source">
                		<b><p2>Canadian Lakes: <a href="http://www.empr.gov.bc.ca/Mining/Geoscience/MapPlace/geoData/Pages/default.aspx" target="_blank">British Columbia Ministry of Energy, Mines, and Petroleum Resources</a></p2></b><br>
                			<p3>Data from 2006.</p3>
                	</div>
                	<div class="source">
                		<b><p2>American Cities: <a href="https://catalog.data.gov/dataset/usgs-small-scale-dataset-cities-and-towns-of-the-united-states-201403-shapefile" target="_blank">USGS</a></p2></b><br>
                	</div>
                	<div class="source">
                		<b><p2>Canadian Cities: <a href="http://www.empr.gov.bc.ca/Mining/Geoscience/MapPlace/geoData/Pages/default.aspx" target="_blank">British Columbia Ministry of Energy, Mines, and Petroleum Resources</a></p2></b><br>
                	</div>
                	<div class="source">
                		<b><p2>Tribal Lands: <a href="https://www.census.gov/geo/maps-data/data/cbf/cbf_aiannh.html" target="_blank">US Census Bureau</a></p2></b><br>
                	</div>
                	<div class="source">
                		<b><p2>Population Data: <a href="https://data2.nhgis.org/main" target="_blank">IPUMS NHGIS, University of Minnesota</a></p2></b><br>
                			<p3>Data from 2010 census. Total population by US Census Block retrieved from IPUMS.</p3>
                	</div>
                	<p2 style="font-size:20px">Basemap</p2><br><br/>
                    	<div class="source">
                    		<b><p2>Background Terrain: <a href = "https://leaflet-extras.github.io/leaflet-providers/preview/index.html#filter=Esri.WorldTerrain" target="_blank">ESRI</a></p2></b><br>
                    			<p3>ESRI Background Terrain; Source: USGS, Esri, TANA, DeLorme, and NPS<p3>
                    	</div>
                    	<div class="source">
                    		<b><p2>Background Labels: <a href = "https://leaflet-extras.github.io/leaflet-providers/preview/#filter=CartoDB.PositronOnlyLabels" target="_blank">Carto</a></p2></b><br>
                    			&copy;<a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy;<a href="http://cartodb.com/attributions">CartoDB</a>
                    	</div>	
				</div>
				<hr>
				<p2 id="map_creation" style="float:right; font-size:16px;">Map created with <a href = "https://leafletjs.com/" target="_blank">Leaflet</a>, <a href = "https://d3js.org/topojson.v1.min.js" target="_blank">D3 TopoJson</a>, <a href = "http://geoserver.org/" target="_blank">Geoserver</a>, and <a href = "https://qgis.org/en/site/" target="_blank">QGIS</a></p2>
				<br/>
				<a class="close2" href="#" style="display:inline;">Close</a>
			</div>
		</div>
		
		<div id="link_popup" class="link_overlay">
			<div class="link_popup">
				<a class="close" href="#" style="display:inline;">×</a>
				<div class="content">
					<a href="water_home.html" style="font-weight:bold; text-decoration:none;">Water Home</a>
					<hr>
					<a href="watershed.html" style="text-decoration:underline;">Watersheds</a>
					<a href="groundwater.html" style="text-decoration:underline;">Groundwater</a>
					<a href="water_use.html" style="text-decoration:underline;">Water Use</a>
					<a href="pollution.html" style="text-decoration:underline;">Water Pollution</a>
					<hr>
					<a href="../index.html" style="font-weight:bold; text-decoration:none;">Atlas Home</a>
				</div>
			</div>
		</div>
		
		<div id="share" class="share_overlay">
			<div class="share_popup">
				<a id="clear" href="#" style="display:none;">×</a>
				<div class="content">
					<a href="https://facebook.com/sharer.php?u=https://rawgit.com/osulp/PNWatlas/master/water/watershed.html" id="arrow" style="display:inline-block;">
						<i class="fa fa-facebook-square " aria-hidden="true" style="padding-left:0;"></i>
					</a>
					<a href="https://twitter.com/home?status=PNW%20Watersheds%0Ahttp%3A//rawgit.com/osulp/PNWatlas/master/water/watershed.html" id="arrow" style="display:inline-block;">
						<i class="fa fa-twitter-square " aria-hidden="true" style="padding-left:0;"></i>
					</a>
				</div>
			</div>
		</div>
<script>
	L.TopoJSON = L.GeoJSON.extend({  
  		addData: function(jsonData) {    
    		if (jsonData.type === 'Topology') {
      			for (key in jsonData.objects) {
       			 geojson = topojson.feature(jsonData, jsonData.objects[key]);
       			 L.GeoJSON.prototype.addData.call(this, geojson);
      		}
    	}    
    	else {
      		L.GeoJSON.prototype.addData.call(this, jsonData);
    		}
  		}  
	});
	
	var collapsed = false;
    function collapse(){
    	if (collapsed == false){
    		document.getElementById("infoPanel").style.transition = "display 2s";
    		document.getElementById("infoPanel").style.display = "none";
    		document.getElementById("collapse").style.left = '0px';
    		document.getElementById("collapse").style.paddingLeft = '2px';
    		document.getElementById("collapse-arrow").className = "fa fa-chevron-right";
    		collapsed = true;
    	} else{
    		document.getElementById("infoPanel").style.display = "unset";
    		document.getElementById("collapse").style.left = '320px';
    		document.getElementById("collapse").style.paddingLeft = '0px';
    		document.getElementById("collapse-arrow").className = "fa fa-chevron-left";
    		collapsed = false;
    	}
    	
    }
    
    function centerMap(){
		var width = document.documentElement.clientWidth;
		
		if (width < 1500 && width > 800) {
        	map.setView(new L.LatLng(45.56, -121.75), 6); 
    		}  else if (width > 1501) {
        	map.setView(new L.LatLng(45.56, -119.75), 7); 
        	} else {
        	map.setZoom(5);
        	}
	}
	//initialize map
	var map = L.map('map', {center: [46.7, -120.15], zoom: 6, zoomControl:false});
	//map.setMaxBounds(map.getBounds());
///////////////////////make zoom level correspond to browser size////////////////////////////////
	window.addEventListener('load', function(event){
    	var width = document.documentElement.clientWidth;
    	if (width < 1500 && width > 800) {
        	map.setView(new L.LatLng(47.15, -124.15), 5); 
    		}  else if (width > 1501) {
        	map.setZoom(6);
        	} else {
        	map.setZoom(5);
        	}
	});

	map.setMaxBounds(map.getBounds());
	
	map.options.maxZoom = 10;
	map.options.minZoom = 5;
///////////////////////basemap tiles////////////////////////////////
	
	var Esri_WorldTerrain = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}', {
		attribution: 'Tiles &copy; Esri &mdash; Source: USGS, Esri, TANA, DeLorme, and NPS',
		maxZoom:10,
		minZoom:5,
		opacity:1
	}).addTo(map);
	
	var CartoDB_PositronNoLabels = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_nolabels/{z}/{x}/{y}.png', {
		attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
		subdomains: 'abcd',
		maxZoom:10,
		minZoom:5,
		opacity:0.5
	}).addTo(map);
	
	var watershed_outline = L.tileLayer.wms('https://geoserver.library.oregonstate.edu/geoserver/PNW_ATLAS/wms', {
		layers: 'PNW_ATLAS:watershed_outline',
        format: 'image/png',
		maxZoom:10,
		minZoom:5,
		opacity:0.3,
		transparent:true
	}).addTo(map);
///////////////////////label tiles////////////////////////////////	
	var label = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_only_labels/{z}/{x}/{y}@2x.png', {
		attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
		subdomains: 'abcd',
		maxZoom:10,
		minZoom:5,
		tileSize:256,
		bounds:[
			new L.LatLng(49.56,-125.25),
			new L.LatLng(40.5,-111.5)
		],
		pane:'labels'
	});	
//create pane to add labels above basemap and geojson features
	map.createPane('labels');
	map.getPane('labels').style.pointerEvents = 'none';
	map.getPane('labels').style.zIndex = 650;
	label.addTo(map);
	
	map.createPane('tooltip');
	map.getPane('tooltip').style.zIndex = 700;
	//map.setMaxBounds(map.getBounds());
	

///////////////////////important variables////////////////////////////////
	var data = 1; //switch between watershed scales
	var layers = 0; //determine if watershed has already been selected when switching scales 
	var hoverSelection; //used with info control to determine which data to display
	
	var border = 0;
	//geoJSON variables
	var dams;
	var cities;
	var reservations;
	var rivers; 
	var riversHUC8;
	var lakes;
	var lakesHUC8;
	var clickID;
	
	
///////////////////////info panel////////////////////////////////
	var info = L.control();

	info.onAdd = function (map) {
    	this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
    	this.update();
    	return this._div;
	};
	
	info.update = function (props) {
    this._div.innerHTML =   ('<b style="font-size:24px;">Hover over Water Features</b>');
	};

///////////////////////HUC4 (regional) scale////////////////////////////////	
    var clickHUC4;
	var watershedHUC4;
	
	watershedHUC4 = new L.TopoJSON(null, {
		});
		
	$.getJSON('assets/watershedHUC4.json')
			.done(watershedHUC4AddTopoData);

	function watershedHUC4AddTopoData(topoData) {  
		watershedHUC4.addData(topoData);
		watershedHUC4.addTo(map);
		watershedHUC4.eachLayer(watershedHUC4HandleLayer);
	}

	function watershedHUC4HandleLayer(layer){
		layer.setStyle({
				fillColor:'#cce0ff',
				fillOpacity: 0.4,
				color: '#1a75ff', 							
				opacity: 0.5,
				weight: 1,
				dashArray:4
		});
		layer.on({
				mouseover : HUC4Highlight,
				mouseout: resetHUC4Highlight,
				click: HUC4Click
			});
	}
	
	function HUC4Highlight(){
		if (clickHUC4 != this){
			this.setStyle({
				fillOpacity:0.7,
			 });
    	}
	}
	
	function resetHUC4Highlight(){
		if (clickHUC4 != this){
			this.setStyle({
				fillOpacity:0.4,
			 });
    	}
	}
	
	function HUC4Click(){
		resetClickHUC4();
		
		info.addTo(map);
			
		clickHUC4 = this;
		clickID = this.feature.properties.HUC4;
				
		this.setStyle ({
			fillOpacity: 0.7,
		});

		addReservations();
		addCities();
		$.when(cities).done(function(){
			addLakes();
			addRivers();
			$.when(rivers).done(function(){
				addDams();
			});
		});
		
		buttonFunctions.but1.newLayers.push(dams,rivers,cities,lakes,reservations);
		
		$('#watershed_desc').css('display', 'block');
		$('#watershed_legend').css('display', 'block');
		document.getElementById('title').innerHTML = this.feature.properties.Name;
		document.getElementById('area').innerHTML = this.feature.properties.area_sqmi + '&nbspSq. Mi.';
		document.getElementById('dams').innerHTML = this.feature.properties.dams_major;
		document.getElementById('population').innerHTML = this.feature.properties.POPULATION;
		document.getElementById('cities').innerHTML = this.feature.properties.cities_001;
		document.getElementById('states').innerHTML = this.feature.properties.States;
		document.getElementById('counties').innerHTML = this.feature.properties.counties;
		
		map.fitBounds([
			[this.feature.properties.y1, this.feature.properties.x1 - 0.8],
			[this.feature.properties.y2, this.feature.properties.x2 - 0.8]
		]);
	}
	
	function resetClickHUC4(){
		if (clickHUC4){
			clickHUC4.setStyle ({
				fillOpacity: 0.4,
			});
		}
	}

///////////////////////HUC6 (subregional) scale////////////////////////////////	    
   	var clickHUC6;
	var watershedHUC6;
	
	watershedHUC6 = new L.TopoJSON(null, {
		});
		
	$.getJSON('assets/watershedHUC6.json')
			.done(watershedHUC6AddTopoData);

	function watershedHUC6AddTopoData(topoData) {  
		watershedHUC6.addData(topoData);
		watershedHUC6.eachLayer(watershedHUC6HandleLayer);
	}

	function watershedHUC6HandleLayer(layer){
		layer.setStyle({
				fillColor:'#cce0ff',
				fillOpacity: 0.4,
				color: '#1a75ff', 							
				opacity: 0.5,
				weight: 1,
				dashArray:4
		});
		layer.on({
				mouseover : HUC6Highlight,
				mouseout: resetHUC6Highlight,
				click: HUC6Click
			});
	}
	
	function HUC6Highlight(){
		if (clickHUC6 != this){
			this.setStyle({
				fillOpacity:0.7,
			 });
    	}
	}
	
	function resetHUC6Highlight(){
		if (clickHUC6 != this){
			this.setStyle({
				fillOpacity:0.4,
			 });
    	}
	}
	
	function HUC6Click(){
		resetClickHUC6();
		
		info.addTo(map);
			
		clickHUC6 = this;
		clickID = this.feature.properties.HUC6;
				
		this.setStyle ({
			fillOpacity: 0.7,
		});

		console.log(clickID);
		addReservations();
		addCities();
		$.when(cities).done(function(){
			addLakes();
			addRivers();
			$.when(rivers).done(function(){
				addDams();
			});
		});
		
		buttonFunctions.but2.newLayers.push(dams,rivers,cities,lakes,reservations);
		
		$('#watershed_desc').css('display', 'block');
		$('#watershed_legend').css('display', 'block');
		document.getElementById('title').innerHTML = this.feature.properties.Name;
		document.getElementById('area').innerHTML = this.feature.properties.area_sqmi + '&nbspSq. Mi.';
		document.getElementById('dams').innerHTML = this.feature.properties.dams_major;
		document.getElementById('population').innerHTML = this.feature.properties.POPULATION;
		document.getElementById('cities').innerHTML = this.feature.properties.cities_001;
		document.getElementById('states').innerHTML = this.feature.properties.States;
		document.getElementById('counties').innerHTML = this.feature.properties.counties;
		
		map.fitBounds([
			[this.feature.properties.y1, this.feature.properties.x1 - 0.8],
			[this.feature.properties.y2, this.feature.properties.x2 - 0.8]
		]);
		
	}
	
	function resetClickHUC6(){
		if (clickHUC6){
			clickHUC6.setStyle ({
				fillOpacity: 0.4,
			});
		}
	}
    
///////////////////////HUC8 (local) scale////////////////////////////////	    
   	var clickHUC8;
	var watershedHUC8;
	
	watershedHUC8 = new L.TopoJSON(null, {
		});
		
	$.getJSON('assets/watershedHUC8.json')
			.done(watershedHUC8AddTopoData);

	function watershedHUC8AddTopoData(topoData) {  
		watershedHUC8.addData(topoData);
		watershedHUC8.eachLayer(watershedHUC8HandleLayer);
	}

	function watershedHUC8HandleLayer(layer){
		layer.setStyle({
				fillColor:'#cce0ff',
				fillOpacity: 0.4,
				color: '#1a75ff', 							
				opacity: 0.5,
				weight: 1,
				dashArray:4
		});
		layer.on({
				mouseover : HUC8Highlight,
				mouseout: resetHUC8Highlight,
				click: HUC8Click
			});
	}
	
	function HUC8Highlight(){
		if (clickHUC8 != this){
			this.setStyle({
				fillOpacity:0.7,
			 });
    	}
	}
	
	function resetHUC8Highlight(){
		if (clickHUC8 != this){
			this.setStyle({
				fillOpacity:0.4,
			 });
    	}
	}
	
	function HUC8Click(){
		resetClickHUC8();
		
		info.addTo(map);
			
		clickHUC8 = this;
		clickID = this.feature.properties.HUC8;
				
		this.setStyle ({
			fillOpacity: 0.7,
		});

		console.log(clickID);
		addReservations();
		addCities();
		$.when(cities).done(function(){
			addLakes();
			addRivers();
			$.when(rivers).done(function(){
				addDams();
			});
		});
		
		buttonFunctions.but3.newLayers.push(dams,rivers,cities,lakes,reservations);
		
		$('#watershed_desc').css('display', 'block');
		$('#watershed_legend').css('display', 'block');
		document.getElementById('title').innerHTML = this.feature.properties.Name;
		document.getElementById('area').innerHTML = this.feature.properties.area_sqmi + '&nbspSq. Mi.';
		document.getElementById('dams').innerHTML = this.feature.properties.dams_total;
		document.getElementById('population').innerHTML = this.feature.properties.POPULATION;
		document.getElementById('cities').innerHTML = this.feature.properties.cities_001;
		document.getElementById('states').innerHTML = this.feature.properties.States;
		document.getElementById('counties').innerHTML = this.feature.properties.counties;
		
		map.fitBounds([
			[this.feature.properties.y1, this.feature.properties.x1 - 0.2],
			[this.feature.properties.y2, this.feature.properties.x2 - 0.2]
		]);
		
	}
	
	function resetClickHUC8(){
		if (clickHUC8){
			clickHUC8.setStyle ({
				fillOpacity: 0.4,
			});
		}
	}
    
///////////////////////tooltip info////////////////////////////////
 
 	function whichText(props){
		return hoverSelection == 0 ? '<h3 style="margin:0; display:inline-block;">' +  props.NAME + '</h3>' :
			hoverSelection ==1 ?'<h3 style="margin:0; display:inline-block;">' +  props.NAME + '</h3>' :
				'<h3 style="display:inline;">' + props.NAME + '</h3><br/><p style="display:inline;">Height:&nbsp' + props.HEIGHT + '&nbspft.<br/>Storage:&nbsp' + props.STORAGE + '&nbspacre ft.<br/>Year Completed:&nbsp' + props.YEAR + '</p>';
	}
  
///////////////////////dams geoJson styling////////////////////////////////

	var dams;

    function addDams(){
    	if (dams){
    		map.removeLayer(dams);
    	}
    	
    	dams = null;
    	dams = new L.TopoJSON(null, {
  		  filter: function(feature, layer) {
				if (data == 1){
					if (feature.properties.HUC4 == clickID && (feature.properties.HEIGHT > 50 || feature.properties.storage > 5000))return true 
				}
				else if (data == 2) {
					if (feature.properties.HUC6 == clickID && (feature.properties.HEIGHT > 50 || feature.properties.storage > 5000))return true 
				} 
				else {
					if (feature.properties.HUC8 == clickID)return true 
				}
  			},
  			onEachFeature: function(feature, featureLayer){
  				  featureLayer.bindTooltip('<h3 style="display:inline;">' + feature.properties.NAME + '</h3><br/><p style="display:inline;">Height:&nbsp' + feature.properties.HEIGHT + '&nbspft.<br/>Storage:&nbsp' + feature.properties.STORAGE + '&nbspacre ft.<br/>Year Completed:&nbsp' + feature.properties.YEAR + '<br/>Hazard Rating: '+ feature.properties.HAZARD +'</p>', {className: 'label_tooltip', pane:'tooltip'});
  			},
  			pointToLayer: function (feature, latlng) {
    			return L.circleMarker(latlng, {});
    		}
		});
		
		$.getJSON('assets/total_dams.json')
  		.done(addDamData);
  		
		function addDamData(topoData) {  
			dams.addData(topoData);
			dams.addTo(map);
			dams.eachLayer(handleDamLayer);
		}
	
		function handleDamLayer(layer){
        	layer.setStyle({
          		color: '#ffffff',
    			fillColor: damColor(layer.feature.properties.HAZARD),
    			radius: damSize(layer.feature.properties.HEIGHT),
    			opacity: 1,
    			fillOpacity: 1,
    			weight: 0.5
			});
			layer.on({
				mouseover : damHighlight,
				mouseout: resetDamHighlight
			});
    	}	
    	
    	function damSize(e){
			if (data == 1 || data == 2){
				return e > 300 ? 8:
					e > 200 ? 6:
					e > 100 ? 4:
					e > 25 ? 3:
						2; 
				}
			else{
				return e > 300 ? 9:
					e > 200 ? 7.5:
					e > 100 ? 6:
					e > 25 ? 4.5:
						3;
				}
		}
	
		function damColor(e){
			return e == 'H' ? '#000000':
				e == 'S' ? '#000000':
					'#000000'; 
		}
    	
    	function damHighlight() {
			 this.setStyle({
				fillColor: '#ffffff'
			 });
		}
	//reset feature function (after highlight)
		function resetDamHighlight(e) {
			 this.setStyle({
				fillColor: damColor(this.feature.properties.HAZARD)
			 });
		}

    }
    
///////////////////////cities geoJson styling////////////////////////////////

    function addCities(){
    	if (cities){
    		map.removeLayer(cities);
    	}
    	cities = null;
    	cities = new L.TopoJSON(null, {
			  	filter: filter,
				interactive:false
		});
		
		$.getJSON('assets/watershed_city_area.json')
			.done(cityAddTopoData);

		function cityAddTopoData(topoData) {  
			cities.addData(topoData);
			cities.addTo(map);
			cities.eachLayer(cityHandleLayer);
		}
	
		function cityHandleLayer(layer){
			layer.setStyle({
				fillColor: '#d9d9d9	',
            	fillOpacity:0.8,
            	weight: 1,
            	opacity: 0.8,
            	color: '#d9d9d9'
			});

		}
    }
///////////////////////reservations geoJson styling////////////////////////////////    
    function addReservations(){
    	if (reservations){
    		map.removeLayer(reservations);
    	}
    	
    	reservations = null;
    	reservations = new L.TopoJSON(null, {
			  	filter:filter,
				interactive:false
		});
		
		$.getJSON('assets/watershed_reservations.json')
			.done(reservationAddTopoData);

		function reservationAddTopoData(topoData) {  
			reservations.addData(topoData);
			reservations.addTo(map);
			reservations.eachLayer(resHandleLayer);
		}
	
		function resHandleLayer(layer){
			layer.setStyle({
				fillColor: '#ededdc',
            	fillOpacity:0.8,
            	weight: 1,
            	opacity: 0.8,
            	color: '#ededdc'
			});

		}

    }
///////////////////////rivers geoJson styling////////////////////////////////
     function riverHighlight() {
		this.setStyle({
			opacity: 0.4,
			color:'#ffffff',
			weight:3
			});
	}
	//reset feature function (after highlight)
	
	function resetRiverHighlight() {
		this.setStyle({
        		opacity: 0.7,
        		color:riverColor(this.feature.properties.FEATURE),
        		weight: riverSize(this.feature.properties.level)
    	 	});
	}
    
    function riverSize(e){
        return e == 1 ? 2.25 :
        	   e == 2 ? 1.75 :
        	   e == 3 ? 1.25 :
        	   e == 4 ? 0.75 :
        		0.5;
    	}   
    	
    function riverColor(string){
        return string == 'Canal' ? '#00cc99' :
        		'#3399ff';
    	}  
    	
    function riverDash(string){
        return string == 'Stream Intermittent' ? '4' :
        		0;
    	}  
    	
    function riverStyle(feature){
	return{
		opacity: 0.7,
		color:riverColor(layer.feature.properties.FEATURE),
		weight: riverSize(layer.feature.properties.level),
		dashArray: riverDash(layer.feature.properties.FEATURE)
		};
	}
    
    function addRivers(){
    	if (rivers){
    		map.removeLayer(rivers);
    	}
    	
    	rivers = null;
    	rivers = new L.TopoJSON(null, {
			  	filter: filter,
				onEachFeature: function(feature, featureLayer) {
        			featureLayer.bindTooltip('<h3 style="margin:0; display:inline-block;">' +  feature.properties.NAME + '</h3>', {className: 'label_tooltip', pane:'tooltip'});
        		}
		});
		
		if (data == 1 || data == 2){
			$.getJSON('assets/watershed_rivers.json')
				.done(riversAddTopoData);
		}
		else{
			$.getJSON('assets/watershed_riversHUC8.json')
				.done(riversAddTopoData);
		}

		function riversAddTopoData(topoData) {  
			rivers.addData(topoData);
			rivers.addTo(map);
			rivers.eachLayer(riversHandleLayer);
		}
	
		function riversHandleLayer(layer){
			layer.setStyle({
				opacity: 1,
				color:riverColor(layer.feature.properties.FEATURE),
				weight: riverSize(layer.feature.properties.level),
				dashArray: riverDash(layer.feature.properties.FEATURE)
			});
			layer.on({
				mouseover : riverHighlight,
				mouseout: resetRiverHighlight
			});
		}
    }
    
///////////////////////lakes geoJson styling////////////////////////////////
	function filter(feature) {
			if (data == 1){
        		if (feature.properties.HUC4 == clickID)return true 
        	}
        	else if (data == 2) {
        		if (feature.properties.HUC6 == clickID)return true 
        	} 
        	else {
        		if (feature.properties.HUC8 == clickID)return true 
        	}
    	}
    
    function addLakes(){
    	if (lakes){
    		map.removeLayer(lakes);
    	}
    	
    	lakes = null;
    	lakes = new L.TopoJSON(null, {
			  	filter: filter,
				onEachFeature: function(feature, featureLayer) {
        			featureLayer.bindTooltip('<h3 style="margin:0; display:inline-block;">' +  feature.properties.NAME + '</h3>', {className: 'label_tooltip', pane:'tooltip'});
        		}
		});
		
		$.getJSON('assets/watershed_lakes.json')
			.done(lakesAddTopoData);

		function lakesAddTopoData(topoData) {  
			lakes.addData(topoData);
			lakes.addTo(map);
			lakes.eachLayer(lakeHandleLayer);
		}
	
		function lakeHandleLayer(layer){
			layer.setStyle({
				opacity: 0.7,
				fillOpacity: 0.7,
				color:lakeColor(layer.feature.properties.FEATURE),
				fillColor:lakeColor(layer.feature.properties.FEATURE),
				weight:0.5
			});
			layer.on({
				mouseover : lakeHighlight,
				mouseout: resetLakeHighlight
			});
		}
    	 
    	function lakeColor(string){
        return string == 'Lake Intermittent' ? '#b3daff' :
        		'#3399ff';
    	}  
    	
    	 function lakeHighlight() {
				this.setStyle({
					fillOpacity: 0.4,
					opacity: 0.4,
					fillColor:'#ffffff',
					color:'#ffffff'
					});
			}
		//reset feature function (after highlight)
		function resetLakeHighlight() {
				this.setStyle({
					fillOpacity: 0.7,
					opacity: 0.7,
					fillColor:lakeColor(this.feature.properties.FEATURE),
					color:lakeColor(this.feature.properties.FEATURE)
				});
			}
    }

////////////////////////////////////////////////////////////////////////////////////////////

	var buttonLabels = ['#but1','#but2','#but3'];

	var buttonFunctions = {
		but1: {
			   button:'but1', 
			   newLayers:[watershedHUC4], 
			   //newLegend: 'leg_1', 
			   title:'Regional', 
			   variable:1,
			   layerFunction: function(){
			   		map.setView([46.7, -120.15], 6);
			   		document.getElementById('dams_title').innerHTML = 'Large Dams<sup class="tooltip">?<span class="tooltiptext">Dams higher than 50 ft. or capacity greater than 5000 acre ft.</span></sup>:';
			   		document.getElementById('title').innerHTML = "Select a Watershed";
			   		resetClickHUC4();
			   		clickHUC4 = null;
			   		buttonFunctions.but1.newLayers.splice(1);
			   		buttonFunctions.but2.newLayers.splice(1);
			   		buttonFunctions.but3.newLayers.splice(1);
			   		$('#watershed_desc').css('display', 'none');
			   		$('#watershed_legend').css('display', 'none');
			   }
			},
		but2: {
			   button:'but2', 
			   newLayers:[watershedHUC6], 
			   //newLegend: 'leg_1', 
			   title:'Subregional', 
			   variable:2,
			   layerFunction: function(){
			   		resetClickHUC6();
			   		clickHUC6 = null;
			   		document.getElementById('dams_title').innerHTML = 'Large Dams<sup class="tooltip">?<span class="tooltiptext">Dams higher than 50 ft. or capacity greater than 5000 acre ft.</span></sup>:';
			   		document.getElementById('title').innerHTML = "Select a Watershed";
			   		buttonFunctions.but1.newLayers.splice(1);
			   		buttonFunctions.but2.newLayers.splice(1);
			   		buttonFunctions.but3.newLayers.splice(1);
			   		$('#watershed_desc').css('display', 'none');
			   		$('#watershed_legend').css('display', 'none');
			   }
			},
		but3: {
			   button:'but3', 
			   newLayers:[watershedHUC8], 
			  // newLegend: 'leg_1', 
			   title:'Local', 
			   variable:3,
			   layerFunction: function(){
			   		resetClickHUC8();
			   		clickHUC8 = null;
			   		document.getElementById('dams_title').innerHTML = 'Dams<sup class="tooltip">?<span class="tooltiptext">Dams higher than 10 ft. or capacity greater than 1000 acre ft.</span></sup>:';
					document.getElementById('title').innerHTML = "Select a Watershed";
					buttonFunctions.but1.newLayers.splice(1);
			   		buttonFunctions.but2.newLayers.splice(1);
			   		buttonFunctions.but3.newLayers.splice(1);
			   		$('#watershed_desc').css('display', 'none');
			   		$('#watershed_legend').css('display', 'none');
			   }
			}
	};
	
	$('.main1').clickFunction({
		buttonFunctions: buttonFunctions,
		buttonLabels: buttonLabels,
		selected:buttonFunctions.but1
	});


function HUC4(){
	removeLayers();
	map.setView([46.7, -120.15], 6);
	document.getElementById('but1').style.background = "rgba(242, 242, 242, 0.9)";
	document.getElementById('but2').style.background = "rgba(242,242,242,0.2)";
	document.getElementById('but3').style.background = "rgba(242,242,242,0.2)";
	document.getElementById('dams_title').innerHTML = 'Large Dams<sup class="tooltip">?<span class="tooltiptext">Dams higher than 50 ft. or capacity greater than 5000 acre ft.</span></sup>:';
	document.getElementById('selection').innerHTML = 'Regional';
	watershedHUC4.addTo(map);
	clearClickHUC4();
	scale=0;
}

function HUC6(){
	removeLayers();
	document.getElementById('but1').style.background = "rgba(242,242,242,0.2)";
	document.getElementById('but2').style.background = "rgba(242, 242, 242, 0.9)";
	document.getElementById('but3').style.background = "rgba(242,242,242,0.2)";
	document.getElementById('dams_title').innerHTML = 'Large Dams<sup class="tooltip">?<span class="tooltiptext">Dams higher than 50 ft. or capacity greater than 5000 acre ft.</span></sup>:';
	document.getElementById('selection').innerHTML = 'Subregional';
	watershedHUC6.addTo(map);
	clearClickHUC6();
	scale=1;
}

function HUC8(){
	removeLayers();
	document.getElementById('but1').style.background = "rgba(242,242,242,0.2)";
	document.getElementById('but2').style.background = "rgba(242,242,242,0.2)";
	document.getElementById('but3').style.background = "rgba(242, 242, 242, 0.9)";
	document.getElementById('dams_title').innerHTML = 'Dams<sup class="tooltip">?<span class="tooltiptext">Dams higher than 10 ft. or capacity greater than 1000 acre ft.</span></sup>:';
	document.getElementById('selection').innerHTML = 'Local';
	watershedHUC8.addTo(map);
	clearClick();
	scale=2;
}

//////////////////////////////////////border toggle/////////////////////////////////////////////////

  var watershedBorders = L.tileLayer.wms('https://geoserver.library.oregonstate.edu/geoserver/PNW_ATLAS/wms', {
		layers: 'PNW_ATLAS:watershed_borders',
        format: 'image/png',
		maxZoom:10,
		minZoom:5,
		opacity:1,
		transparent:true,
		pane: 'borders'
	});
//create pane to add labels above basemap and geojson features
	map.createPane('borders');
	map.getPane('borders').style.pointerEvents = 'none';
	map.getPane('borders').style.zIndex = 800;

    
    function borders() {
    	if (border == 0){
    		border = 1;
    		watershedBorders.addTo(map);
    	}
    	else {
    		border = 0;
    		map.removeLayer(watershedBorders);
    	}
    } 

////////////////////////////////////////////////////////////////////////////////////////////


    new L.Control.Zoom({ position: 'bottomright' }).addTo(map);
	document.getElementsByClassName("leaflet-control-attribution")[0].style.visibility = "hidden";
	//add scrolling capabilities to text box
     var container = document.getElementById('text');
		Ps.initialize(container);
	
	var minHeight = 30; // Define a minimum height for the middle div

	var resizeMiddle = function() {
    var h = $('body').height() - $('#top').height() - 80;
    		h = h > minHeight ? h : minHeight;
   	 	$('#attribution').height(h);
	}
	
	function resizePopup() {
   		var h = $('.popup').height() - 90;
    		h = h > minHeight ? h : minHeight;
   	 	$('.popup .content').height(h);
	}
	$(document).ready(resizePopup);
	$(window).resize(resizePopup);

	$(document).ready(resizeMiddle);
	$(window).resize(resizeMiddle);
	
	
    $(document).click(function(event) {
		if (!$(event.target).closest(".share_overlay,.share,#sources,#link_popup").length) {
			$('#clear')[0].click();
		}
	});


</script>
</body>
</html>
