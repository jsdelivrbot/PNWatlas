<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
     <title>Parks & Protected Lands</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" /> 
    <link rel="stylesheet" href="css/parks_style.css" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Maven+Pro" rel="stylesheet">
    <link rel="stylesheet" href="css/perfect-scrollbar.css" />
    <link rel="stylesheet" href="css/leaflet-search.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <link rel="shortcut icon" href="img/pnw.ico" type="image/x-icon">
    
    <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="js/perfect-scrollbar.js"></script>
    <script src="js/leaflet-search.js"></script>
   
</head>
<body>
		<div id="infoPanel">
			<div id="top">
			<h1>Parks & Protected Areas</h1>
			<img src="img/park_icon.png" id="image" style="display:inline-block;"> <br/>
			<!--<input type="text" name="search" placeholder="Search for a park..."><br/><br/>-->
			<div id="findbox"></div>
			<h2 id="title" style="display:inline; width:200px; white-space:normal;">Park Type</h2><img src="img/people.png" id="image2" style="display:inline-block; float:right;"> 
			<br>	
			<div class = "legendContainer"><b id ="legend1" class="legend" style="background:#43765d;"></b></div><p>&nbsp</p><p id="leg1">National Forest</p><br/>
			<div class = "legendContainer"><b id ="legend2" class="legend" style="background:#28bd98;"></b></div><p>&nbsp</p><p id="leg2">National Wildlife</p><br/>
			<div class = "legendContainer"><b id ="legend3" class="legend" style="background:#95d964;"></b></div><p>&nbsp</p><p id="leg3">National Park</p><br/>
			<div class = "legendContainer"><b id ="legend4" class="legend" style="background:#9dc8b4;"></b></div><p>&nbsp</p><p id="leg4">State Forest</p><br/>
			<div class = "legendContainer"><b id ="legend5" class="legend" style="background:#aab955;"></b></div><p>&nbsp</p><p id="leg5">State Park</p><br/><br/>
			<p id="description" style="font-weight:bold; padding:0; display:block; white-space:normal; width:280px;">County/Municipal Parks are not represented in the map.</p>
			<br/><br/><br/>
			</div>
			<div id="attribution">
				<p style="padding-right:5px; padding-top:3px; padding-left:0px; font-weight:bold; position:relative; float:left;">Parks</p>
						<label class="switch">
							<input name="checkbox_name" id="checkbox_id" type="checkbox" value="check" onclick="selectSwitch()" autocomplete="off">
							<span class="slider"></span>
						</label>
					<p style="padding-left:5px; padding-top:3px; font-weight:bold;">Visitation</p><br/>
				<div id="text" style="margin-top:10px;">
						<p3>Since its inception in 1916, the National Park Service has managed each of the United States' national parks, which have grown in number over the years to 59. Yellowstone National Park was the first national park in the United States. In 1872, there was no state government to manage it, so the federal government assumed direct control. Yosemite National Park began as a state park; the land for the park was donated by the federal government to the state of California in 1864 for perpetual conservation. Yosemite was later returned to federal ownership. âˆ‚At first, each national park was managed independently, with varying degrees of success. In Yellowstone, the civilian staff was replaced by the U.S. Army in 1886. Due to the irregularities in managing these national treasures, Stephen Mather petitioned the federal government to improve the situation. In response, Secretary of the Interior Franklin K. Lane challenged him to lobby for creating a new agency, the National Park Service, to manage all national parks and some national monuments. Mather was successful with the ratification of the National Park Service Organic Act in 1916.[8] Later, the agency was given authority over other protected areas, many with varying designations as Congress created them.</p3>
				</div>
				<br/>
			</div>
			<div id="pageChange">
				<a href="economic_index.html" id="arrow" style="display:inline-block;">
					<i class="fa fa-arrow-left" aria-hidden="true" style=""></i>
				</a>
				<a href="source_index.html" id="arrow" style="display:inline-block;" target="_blank">
					<i class="fa fa-info-circle" aria-hidden="true" style="padding-left:83px;"></i>
				</a>
				<a href="recreation_index.html" id="arrow" style="display:inline-block;" target="_blank">
					<i class="fa fa-home" aria-hidden="true" style="padding-left:0;"></i>
				</a>
				<a href="hunting_index.html" id="arrow" style="display:inline-block;">
					<i class="fa fa-arrow-right" aria-hidden="true" style="padding-left:82px;"></i>
				</a>
			</div>
		</div>
    	<div id="map" style="width: 100%; height: 100%;"></div>
    	
<script>
	//initialize map
	var map = L.map('map', {center: [45.56, -119.75], zoom: 7, zoomControl:false});
	//map.setMaxBounds(map.getBounds());
	///////////////////////make zoom level correspond to browser size////////////////////////////////
	window.addEventListener('load', function(event){
    	var width = document.documentElement.clientWidth;
    	if (width < 1500 && width > 800) {
        	map.setView(new L.LatLng(45.56, -121.75), 6); 
    		}  else if (width > 1501) {
        	map.setZoom(7);
        	} else {
        	map.setZoom(5);
        	}
	});
	///////////////////////add tiled basemap////////////////////////////////
	var Esri_WorldTerrain = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}', {
		attribution: 'Tiles &copy; Esri &mdash; Source: USGS, Esri, TANA, DeLorme, and NPS',
		maxZoom:10,
		minZoom:4
	}).addTo(map);
	
	//variable defining which data is selected (park areas or points)
	var layer = 1;
	
	///////////////////////add info panel in the upper right////////////////////////////////
	var info = L.control();

	info.onAdd = function (map) {
    	this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
    	this.update();
    	return this._div;
	};
	
	info.update = function (props) {
	//determines which data to display in info panel (park owner/park visitation)
	function whichData (){
		return layer === 1 ? '</p><br/>Owner:&nbsp'+ props.d_Own_Name:
			layer === 2 ? '</p><br/>Annual Visitation:&nbsp' + props.day_use_an:
				props.d_Own_Name;
		}
    this._div.innerHTML = '<h3 style="margin:0; display:inline-block;">Park Name</h3><br/>' + (props ?
        '<p id="displayType" style="display:inline;">' + props.Unit_Nm +  whichData()
        : 'Hover over parks');
	};

	info.addTo(map);
	////////////////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////geoJson styles and layers///////////////////////////////////////// 
	
	//connect raw data to variables
	
	//////////Highlight and reset park layers////////////
	//highlight feature function
	function highlight(e) {
		 var layer = e.target;
		 layer.setStyle({
        	fillOpacity: 1,
        	dashArray: 4
    	 });
    	 info.update(layer.feature.properties);
		}
	//reset feature function (after highlight)
	function resetHighlight(e) {
		var layer = e.target;
		 layer.setStyle({
        	fillOpacity: 0.7,
        	dashArray: 0
    	 });
		 info.update();		 
	}
	///////////////////////////////////////////
	/////////////Total Parks layer/////////////
	//determine colors based on park ownership
	function parkColor (value){
        	return value === 1 ? '#43765d' :
        			value === 2 ? '#95d964' :
        			value === 3 ? '#28bd98' :
        			value === 4 ? '#9dc8b4' :
        			value === 5 ? '#aab955' :
        				'#ffffff';
        	}
    //total parks style
    function style (feature) {
    	return {
        		color:parkColor(feature.properties.park_type),
        		weight:1,
        		opacity: 1,
				fillOpacity:0.7,
				fillColor:parkColor(feature.properties.park_type)
				};
    }
    //total parks layer
    var totalParks = L.geoJson(null, {
        	style:style,
        	onEachFeature: function(feature, featureLayer) {
        		featureLayer.bindPopup('<b>' + feature.properties.Unit_Nm + '</b><br/>' + feature.properties.d_Own_Name, {className: 'label_tooltip'});
        		featureLayer.on({
        			mouseover: highlight,
        			mouseout: resetHighlight,
   				});
        	}
        }).addTo(map);  
    
    $.getJSON("http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_PNW_ATLAS:parks_total&maxFeatures=1500&outputFormat=application%2Fjson", function(data) {
        totalParks.addData(data);
    });
    ///////////////////////////////////////////
    /////////////Park Points layer/////////////
    //determine point size based on visitation
    function pointSize (value){
        		return value > 1000000 ? 15 :
        			value > 500000 ? 10 :
        			value > 250000 ? 8 :
        			value > 100000 ? 5 :
        			value > 0 ? 3 :
        				0;
        	}
	//park points layer (style included in layer)
     var parkPoints = L.geoJson(null, {
        	pointToLayer: function (feature, latlng) {
    			return L.circleMarker(latlng, {
    				color: '#ffffff',
    				fillColor: '#004d00',
    				radius: pointSize(feature.properties.day_use_an),
    				opacity: 1,
    				fillOpacity: 0.7,
    				weight: 0.5
    			}
    				).bindPopup('<b style="display:inline;">'+ feature.properties.Unit_Nm + '</b><br/><p style="display:inline;">Annual Visitation:&nbsp</p>' + feature.properties.day_use_an, {className: 'label_tooltip'});
    			},
    			onEachFeature: function(feature, featureLayer) {
        		featureLayer.on({
        			mouseover: highlight,
        			mouseout: resetHighlight,
   				});
        	}
        });
        
     $.getJSON("assets/park_points.geojson", function(data) {
        parkPoints.addData(data);
    });
	//////////////////////////////////////////
	/////////////Background layers/////////////
	//gray out non-PNW area
	function outlineStyle(){
	return{
		opacity: 0,
		fillOpacity:0.3,
		fillColor:'#000000'
		};
	}
    var	pnwOutline = $.getJSON("assets/pnw_boundary.geojson", function(data){
        pnwOutline = L.geoJson(data, {
        	style:outlineStyle
        }).addTo(map);
    });
    //state outlines
    function pnwStatesStyle(){
	return{
		opacity: 0.3,
		color:'#000000',
		fillOpacity:0,
		fillColor:'#000000',
		weight:1
		};
	}
     var pnwStates = $.getJSON("assets/pnw_states.geojson", function(data){
        pnwStates = L.geoJson(data, {
        	style:pnwStatesStyle
        }).addTo(map);
    });
    //county outlines
    function pnwCountiesStyle(){
	return{
		opacity: 0.2,
		color:'#000000',
		fillOpacity:0,
		fillColor:'#000000',
		weight:0.5
		};
	}
	
     var pnwCounties = $.getJSON("assets/counties2.geojson", function(data){
        pnwCounties = L.geoJson(data, {
        	style:pnwCountiesStyle
        });
    });
////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////variables for the switch function, allow the legend to change dynamically with selection/////////////////////////////////////////
var legend = ['legend1','legend2','legend3','legend4','legend5'];
var legText = ['leg1','leg2','leg3','leg4','leg5'];
var color = ['#43765d','#28bd98','#95d964','#9dc8b4','#aab955'];	
var radius = ['28px','19px','15px','10px','5px'];
var bottom = ['9px','2px','2px','1px','1px'];	
////////////////////////////////////////////////////////////////////////////////////////

/////////////////////////////////////switch function///////////////////////////////////////////////////	
function selectSwitch() {
	//visitation points selected
	if (document.getElementById('checkbox_id').checked == true){
		map.removeLayer(totalParks);
		map.addLayer(parkPoints);
		map.addLayer(pnwCounties);
		layer = 2;
		var legValues = ['1,000+','500 - 1,000','250 - 500','100 - 250','Less than 100'];
		for (i = 0; i <5; i++){	
			document.getElementById(legend[i]).classList.remove('legend');
			document.getElementById(legend[i]).classList.add('circle');
			document.getElementById(legend[i]).style.background = "rgba(0,77,0,1)";
			document.getElementById(legend[i]).style.height = radius[i];
			document.getElementById(legend[i]).style.width = radius[i];
			document.getElementById(legend[i]).style.bottom = bottom[i];
			document.getElementById(legText[i]).innerHTML = legValues[i];
		}
		document.getElementById('description').innerHTML = "Annual visitation in thousands of day-use visitors.";
		document.getElementById('title').innerHTML = "Annual Visitation";
		map.removeControl(searchControl);
		map.addControl(searchControlPoints);
		
	} 
	//total parks selected
	else {
		map.removeLayer(parkPoints);
		map.removeLayer(pnwCounties);
		map.addLayer(totalParks);	
		layer = 1;
		var legValues = ['National Forest','National Wildlife','National Park','State Forest','State Park'];
		for (i = 0; i <5; i++){	
			document.getElementById(legend[i]).classList.remove('circle');
			document.getElementById(legend[i]).classList.add('legend');
			document.getElementById(legend[i]).style.background = color[i];
			document.getElementById(legend[i]).style.height = '20px';
			document.getElementById(legend[i]).style.width = '100%';
			document.getElementById(legend[i]).style.bottom = '0px';
			document.getElementById(legText[i]).innerHTML = legValues[i];
		}
		document.getElementById('description').innerHTML = "Local/Municipal Parks are not represented in the map.";
		document.getElementById('title').innerHTML = "Park Type";
		map.removeControl(searchControlPoints);
		map.addControl(searchControl);
	}
}
////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////search controls////////////////////////////////////////////	    
//total parks search control
    var searchControl =  new L.Control.Search({
		container: 'findbox',
		layer: totalParks,
		propertyName: 'Unit_Nm',
		collapsed:false,
		marker:false,
		moveToLocation: function(latlng, Unit_Nm, map) {
			//map.fitBounds( latlng.layer.getBounds() );
			var zoom = map.getBoundsZoom(latlng.layer.getBounds());
  			map.setView(latlng, zoom); // access the zoom
		}
	});   
    searchControl.on('search:locationfound', function(e) {		
    	e.layer.setStyle({fillOpacity:1});
		if(e.layer._popup){
			e.layer.openPopup();
			}
	}).on('search:collapsed', function(e) {
		e.layer.setStyle({fillOpacity:0.7});
	});
	
	map.addControl(searchControl);
/////////////////////////////
//park points search control
	var searchControlPoints =  new L.Control.Search({
		container: 'findbox',
		layer: parkPoints,
		propertyName: 'Unit_Nm',
		collapsed:false,
		marker:false,
		moveToLocation: function(latlng, Unit_Nm, map) {
			//map.fitBounds( latlng.layer.getBounds() );
  			map.setView(latlng, 8); // access the zoom
		}
	});
    searchControlPoints.on('search:locationfound', function(e) {		
    	e.layer.setStyle({fillOpacity:1});
		if(e.layer._popup){
			e.layer.openPopup();
			}
	}).on('search:collapsed', function(e) {
		e.layer.setStyle({fillOpacity:0.7});
	});
/////////////////////////////
	
    new L.Control.Zoom({ position: 'topright' }).addTo(map);
	document.getElementsByClassName("leaflet-control-attribution")[0].style.visibility = "hidden";
	//add scrolling capabilities to text box
     var container = document.getElementById('text');
		Ps.initialize(container);
		
	var minHeight = 50; // Define a minimum height for the middle div

	var resizeMiddle = function() {
    var h = $('body').height() - $('#top').height() - 108;
    		h = h > minHeight ? h : minHeight;
   	 	$('#attribution').height(h);
	}

	$(document).ready(resizeMiddle);
	$(window).resize(resizeMiddle);
	
	
    //remove standard leaflet attribution
    

</script>
</body>
</html>
