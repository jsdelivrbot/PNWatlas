<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
     <title>Watersheds</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" /> 
    <link rel="stylesheet" href="css/watershed_style.css" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Maven+Pro" rel="stylesheet">
    <link rel="stylesheet" href="css/perfect-scrollbar.css" />
    
    <link rel="shortcut icon" href="img/pnw.ico" type="image/x-icon">
    
    <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://unpkg.com/leaflet.vectorgrid@latest/dist/Leaflet.VectorGrid.bundled.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
     <script src="js/perfect-scrollbar.js"></script>
    
   
</head>
<body>
		<div id="infoPanel">
			<div id="top">
			<h1>Watershed Guide</h1>
			<div id="buttons">
				<div class="dropdown">
  					<button class="dropbtn">Select Scale<p id="arrow">&#9660;</p></button>
  					<div class="dropdown-content">
   						 <button type="button" id="but1" onclick="HUC4()" class="species" style="background:rgba(242, 242, 242, 0.8);">Regional</button>
						 <button type="button" id="but2" onclick="HUC6()" class="species">Subregional</button>
						 <button type="button" id="but3" onclick="HUC8()" class="species">Local</button>
 				   </div>
				</div>
			</div>
			<br/>
			<h2 id="title" style="display:inline; width:200px; white-space:normal; font-size:30px;">Select a Watershed</h2><br/>
			<h2 style="display:inline; width:200px; white-space:normal;">Area:</h2>
			<h2 id="area" style="display:inline; width:200px; white-space:normal;"></h2><br/>
			<h2 id="dams_title" style="display:inline; width:200px; white-space:normal;">Large Dams<sup class="tooltip">?<span class="tooltiptext">Dams higher than 50 ft. or capacity greater than 5000 acre ft.</span></sup>:</h2>
			<h2 id="dams" style="display:inline; width:200px; white-space:normal;"></h2><br/>
			<h2 style="display:inline; width:200px; white-space:normal;">Population:</h2>
			<h2 id="population" style="display:inline; width:200px; white-space:normal;"></h2><br/>
			<h2 style="display:inline; width:200px; white-space:normal;">States/Provinces<sup class="tooltip">?<span class="tooltiptext">States and Provinces intersected by the river basin</span></sup>:</h2>
			<h2 id="states" style="display:inline; width:200px; white-space:normal;"></h2><br/>
			<h2 style="display:inline; width:200px; white-space:normal;">Counties<sup class="tooltip">?<span class="tooltiptext">Number of Counties intersected by the river basin. BC is one county.</span></sup>:</h2>
			<h2 id="counties" style="display:inline; width:200px; white-space:normal;"></h2><br/>
			<h2 style="display:inline; width:200px; white-space:normal;">Cities<sup class="tooltip">?<span class="tooltiptext">Incorporated Cities and selected Census Designated Places with population over 1 person</span></sup>:</h2>
			<h2 id="cities" style="display:inline; width:200px; white-space:normal;"></h2><br/>
			<label class="switch">
					<input name="checkbox_name" id="checkbox_id" type="checkbox" value="check" onclick="borders()" autocomplete="off">
					<span class="slider"></span>
			</label>
				<p style="padding-left:5px; padding-top:12px; font-weight:bold;">Toggle Political Borders</p><br/>
			</div>
			<div id="attribution">
				<div id="text" style="margin-top:10px;">
					<hr>
					<div id ="none"><b style="background:#80bfff;"></b><p>&nbsp</p><p id="leg1">Lake/Reservoir</p></div><div id ="none" style="padding-left:150px;"><b style="background:#d9d9d9;"></b><p>&nbsp</p><p id="leg1">Urban Area</p></div><br/>
					<div id ="none"><b style="background:#b3daff;"></b><p>&nbsp</p><p id="leg1">Seasonal Lake</p></div><div id ="none" style="padding-left:150px;"><b style="background:#ededdc;"></b><p>&nbsp</p><p id="leg1">Tribal Land</p></div><br/>
					<div id ="none"><hr style="color:#80bfff; width:35px; float:left; height:2px; background-color:#80bfff; line-height:20px; vertical-align:middle; display:inline; border:none;"/><p id="leg1" style="padding-left:5px;">River</p></div><div id ="none" style="padding-left:150px;"><hr style="color:#00cc99; width:35px; float:left; height:2px; background-color:#00cc99; line-height:20px; vertical-align:middle; display:inline; border:none;"/><p id="leg1" style="padding-left:5px;">Canal</p></div><br/>
					<hr style="color:#80bfff; width:35px; float:left; height:2px; background-color:#ffffff; line-height:20px; vertical-align:middle; display:inline; border:none; border-top:2px dashed #80bfff;"/><p id="leg1" style="padding-left:5px;">Seasonal River</p><br/>
					<br/>
					<div id = "damLegend">
						<h3 style="margin:0; padding:0; font-size:16px;display:inline;">Dam Height in Ft. &nbsp Hazard Rating</h3><br/>
						<div id="damLegendSide"><div id ="size"><b class="circle" style="background:#ffffff; width:17px; height:17px; border: black 1px solid;"></b></div><div id="sizeLabel"><p style="padding-left:36px;">&nbsp301+</p></div></div><div id="damLegendSide" style="margin-left:150px;"><div id ="size"><b class="circle" style="background:#ff0000; width:16px; height:16px; border: #d9d9d9 1px solid;"></b></div><div id="sizeLabel"><p style="padding-left:36px;">&nbspHigh</p></div></div><br/>
						<div id="damLegendSide"><div id ="size"><b class="circle" style="background:#ffffff; width:13px; height:13px; border: black 1px solid;"></b></div><div id="sizeLabel"><p style="padding-left:36px;">&nbsp201 - 300</p></div></div><div id="damLegendSide" style="margin-left:150px;"><div id ="size"><b class="circle" style="background:#ffff99; width:16px; height:16px; border: #d9d9d9 1px solid;"></b></div><div id="sizeLabel"><p style="padding-left:36px;">&nbspSignificant</p></div></div><br/>
						<div id="damLegendSide"><div id ="size"><b class="circle" style="background:#ffffff; width:9px; height:9px; border: black 1px solid;"></b></div><div id="sizeLabel"><p style="padding-left:36px;">&nbsp101 - 200</p></div></div><div id="damLegendSide" style="margin-left:150px;"><div id ="size"><b class="circle" style="background:#33cc33; width:16px; height:16px; border: #d9d9d9 1px solid;"></b></div><div id="sizeLabel"><p style="padding-left:36px;">&nbspLow</p></div></div><br/>
						<div id ="size"><b class="circle" style="background:#ffffff; width:6px; height:6px; border: black 1px solid;"></b></div><div id="sizeLabel"><p style="padding-left:36px;">&nbsp26 - 100</p></div><br/>
						<div id ="size"><b class="circle" style="background:#ffffff; width:3px; height:3px; border: black 1px solid;"></b></div><div id="sizeLabel"><p style="padding-left:36px;">&nbsp0 - 25</p></div>
					</div>
					<br/>
				<hr>
				<p3>Watersheds are independent of political boundaries, which makes watershed management challenging. An upstream water user can be in a different county, or state, or country than a downstream user, and there could be dozens of municipal water users between them. In the mid-20th century, the United States Bureau of Reclamation and Army Corps of Engineers both had a single prevailing strategy for watershed management: build dams. It has taken decades to understand the effects these widespread damming efforts have had on watershed health, not to mention the water conflicts they have created. Nowadays, basin-wide agreements are becoming more commonplace. The Columbia River Treaty was the first, in 1964, and other rivers within the region have followed with agreements of their own. Watershed Councils exist to monitor and advocate for the health of entire watersheds. Their advocacy, as well as tribal groups, have actualized efforts to remove dams throughout the region.</p3>
				</div>
			</div>
			<div id="pageChange" style="background:#ffffff;">
				<a href="polltion_index.html" id="arrow" style="display:inline-block;">
					<i class="fa fa-arrow-left" aria-hidden="true" style=""></i>
				</a>
				<a href="watershed_index.html" id="arrow" style="display:inline-block;" target="_blank">
					<i class="fa fa-info-circle" aria-hidden="true" style="padding-left:83px;"></i>
				</a>
				<a href="water_index.html" id="arrow" style="display:inline-block;" target="_blank">
					<i class="fa fa-home" aria-hidden="true" style="padding-left:0;"></i>
				</a>
				<a href="groundwater_index.html" id="arrow" style="display:inline-block;">
					<i class="fa fa-arrow-right" aria-hidden="true" style="padding-left:82px;"></i>
				</a>
			</div>
		</div>
    	<div id="map" style="width: calc(100% - 320px); height: 100%; left:320px;"></div>

<script>
	//initialize map
	var map = L.map('map', {center: [46.7, -118.69], zoom: 6, zoomControl:false});
	//map.setMaxBounds(map.getBounds());
///////////////////////make zoom level correspond to browser size////////////////////////////////
	window.addEventListener('load', function(event){
    	var width = document.documentElement.clientWidth;
    	if (width < 1500 && width > 800) {
        	map.setView(new L.LatLng(45.56, -121.75), 5); 
    		}  else if (width > 1501) {
        	map.setZoom(6);
        	} else {
        	map.setZoom(5);
        	}
	});
	
	
	map.options.maxZoom = 10;
	map.options.minZoom = 5;
///////////////////////basemap tiles////////////////////////////////
	var Esri_WorldTerrain = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}', {
		attribution: 'Tiles &copy; Esri &mdash; Source: USGS, Esri, TANA, DeLorme, and NPS',
		maxZoom:10,
		minZoom:5
	}).addTo(map);
	
	var watershed_outline = L.tileLayer.wms('http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/wms', {
		layers: 'baldricg_PNW_ATLAS:watershed_outline',
        format: 'image/png',
		maxZoom:10,
		minZoom:5,
		opacity:1,
		transparent:true
	}).addTo(map);
///////////////////////label tiles////////////////////////////////	
	var label = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_only_labels/{z}/{x}/{y}.png', {
		attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
		subdomains: 'abcd',
		maxZoom:10,
		minZoom:5,
		opacity:0.9,
		pane: 'labels'
	});
	
	var labelMask = L.tileLayer.wms('http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/wms', {
		layers: 'baldricg_PNW_ATLAS:label_mask',
        format: 'image/png',
		maxZoom:10,
		minZoom:5,
		opacity:1,
		transparent:true,
		pane: 'labels'
	});
//create pane to add labels above basemap and geojson features
	map.createPane('labels');
	map.getPane('labels').style.pointerEvents = 'none';
	map.getPane('labels').style.zIndex = 650;
	label.addTo(map);
	labelMask.addTo(map);
	
	map.createPane('tooltip');
	map.getPane('tooltip').style.zIndex = 700;
	//map.setMaxBounds(map.getBounds());
	

///////////////////////important variables////////////////////////////////
	var scale = 0; //switch between watershed scales
	var layers = 0; //determine if watershed has already been selected when switching scales 
	var hoverSelection; //used with info control to determine which data to display
	
	var border = 0;
	//geoJSON variables
	var damsHUC8;
	var cities;
	var reservations;
	var rivers; 
	var riversHUC8;
	var lakes;
	var lakesHUC8;
	
	
///////////////////////info panel////////////////////////////////
	var info = L.control();

	info.onAdd = function (map) {
    	this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
    	this.update();
    	return this._div;
	};
	
	info.update = function (props) {
    this._div.innerHTML =   ('<h3 style="margin:0; display:inline-block;">Hover over Water Features</h3>');
	};

///////////////////////HUC4 (regional) scale////////////////////////////////	
    var highlightHUC4;
    var clickHUC4;
    var vectorSelectionHUC4;
	var clearHighlightHUC4 = function() {
		if (highlightHUC4 != clickHUC4) {
			watershedHUC4.resetFeatureStyle(highlightHUC4);
		}
		highlightHUC4 = null;
	};
	var clearClickHUC4 = function() {
		if (clickHUC4) {
			watershedHUC4.resetFeatureStyle(clickHUC4);
		}
		clickHUC4 = null;
	};

	

    var watershedHUC4 = $.getJSON("http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_PNW_ATLAS:watershed_HU4&maxFeatures=10&outputFormat=application%2Fjson", function(data){
    	watershedHUC4 = L.vectorGrid.slicer(data, {
			rendererFactory: L.svg.tile,
			vectorTileLayerStyles: {
				sliced: function(properties, zoom) {
					return {
						fillColor:'#cce0ff',
						fillOpacity: 0.5,
						stroke: true,
						fill: true,
						color: '#1a75ff', 							
						opacity: 0.5,
						weight: 1,
						dashArray:4
					}
				}
			},
			interactive: true,
			getFeatureId: function(f) {
				return f.properties.TNMID;
			}
		})
		.on('mouseover', function(e) {
			var properties = e.layer.properties;
			
			clearHighlightHUC4();
			highlightHUC4 = properties.TNMID;

			var style = {
				fillColor:'#cce0ff',
				fillOpacity: 0.9,
				stroke: true,
				fill: true,
				color: '#1a75ff', 							
				opacity: 0.5,
				weight: 1,
			};
			
			watershedHUC4.setFeatureStyle(properties.TNMID, style);
		})
		.on('click', function(e) {
			var properties = e.layer.properties;
			
			info.addTo(map);
			
			clearClickHUC4();
			highlightHUC4 = null;
			clickHUC4 = properties.TNMID;
			clickID = properties.HUC4;
						
			var style = {
				fillColor:'#cce0ff',
				fillOpacity: 0.9,
				stroke: true,
				fill: true,
				color: '#1a75ff', 							
				opacity: 0.5,
				weight: 1,
			};
			
			if (vectorSelectionHUC4 != null){
		    	map.removeLayer(dams);
		   		map.removeLayer(rivers);
		   		map.removeLayer(cities);
		   		map.removeLayer(lakes);
		   		map.removeLayer(reservations);
		   	}
				
			vectorSelectionHUC4 = 1;
			layers = 1;
			
			addReservations();
			addCities();
			$.when(cities).done(function(){
				addLakes();
				addRivers();
				$.when(rivers).done(function(){
					addDams();
				});
			});
			
			
			document.getElementById('title').innerHTML = properties.Name;
			document.getElementById('area').innerHTML = properties.area_sqmi + '&nbspSq. Mi.';
			document.getElementById('dams').innerHTML = properties.dams_major;
			document.getElementById('population').innerHTML = properties.POPULATION;
			document.getElementById('cities').innerHTML = properties.cities_001;
			document.getElementById('states').innerHTML = properties.States;
			document.getElementById('counties').innerHTML = properties.counties;
			
			map.fitBounds([
    			[properties.y1, properties.x1],
    			[properties.y2, properties.x2]
			]);
			
			
			watershedHUC4.setFeatureStyle(properties.TNMID, style);
		}).addTo(map);
	});
		
	$.getJSON("http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_PNW_ATLAS:watershedHUC4&maxFeatures=1500&outputFormat=application%2Fjson", function(data) {
        watershedHUC4.addData(data);
    });
///////////////////////HUC6 (subregional) scale////////////////////////////////	    
    var highlightHUC6;
    var clickHUC6;
    var vectorSelectionHUC6;
	var clearHighlightHUC6 = function() {
		if (highlightHUC6 != clickHUC6) {
			watershedHUC6.resetFeatureStyle(highlightHUC6);
		}
		highlightHUC6 = null;
	};
	var clearClickHUC6 = function() {
		if (clickHUC6) {
			watershedHUC6.resetFeatureStyle(clickHUC6);
		}
		clickHUC6 = null;
	};
	
    var watershedHUC6 = $.getJSON("http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_PNW_ATLAS:watershed_HU6&maxFeatures=50&outputFormat=application%2Fjson", function(data){
    	watershedHUC6 = L.vectorGrid.slicer(data, {
			rendererFactory: L.svg.tile,
			vectorTileLayerStyles: {
				sliced: function(properties, zoom) {
					return {
						fillColor:'#cce0ff',
						fillOpacity: 0.5,
						stroke: true,
						fill: true,
						color: '#1a75ff', 							
						opacity: 0.5,
						weight: 1,
						dashArray:4
					}
				}
			},
			interactive: true,
			getFeatureId: function(f) {
				return f.properties.TNMID;
			}
		})
		.on('mouseover', function(e) {
			var properties = e.layer.properties;
			
			clearHighlightHUC6();
			highlightHUC6 = properties.TNMID;

			var style = {
				fillColor:'#cce0ff',
				fillOpacity: 0.9,
				stroke: true,
				fill: true,
				color: '#1a75ff', 							
				opacity: 0.5,
				weight: 1,
			};
			
			watershedHUC6.setFeatureStyle(properties.TNMID, style);
		})
		.on('click', function(e) {
			var properties = e.layer.properties;
			
			info.addTo(map);
			
			clearClickHUC6();
			highlightHUC6 = null;
			clickHUC6 = properties.TNMID;
			clickID = properties.HUC6;
						
			var style = {
				fillColor:'#cce0ff',
				fillOpacity: 0.9,
				stroke: true,
				fill: true,
				color: '#1a75ff', 							
				opacity: 0.5,
				weight: 1,
			};
			
			if (vectorSelectionHUC6 != null){
		    	map.removeLayer(dams);
		   		map.removeLayer(rivers);
		   		map.removeLayer(cities);
		   		map.removeLayer(lakes);
		   		map.removeLayer(reservations);
		   	}
				
			vectorSelectionHUC6 = 1;
			layers = 1;
			
			addReservations();
			addCities();
			$.when(cities).done(function(){
				addLakes();
				addRivers();
				$.when(rivers).done(function(){
				addDams();
				});
			});
			
			
			document.getElementById('title').innerHTML = properties.Name;
			document.getElementById('area').innerHTML = properties.area_sqmi + '&nbspSq. Mi.';
			document.getElementById('dams').innerHTML = properties.dams_major;
			document.getElementById('population').innerHTML = properties.POPULATION;
			document.getElementById('cities').innerHTML = properties.cities_001;
			document.getElementById('states').innerHTML = properties.states;
			document.getElementById('counties').innerHTML = properties.counties;
			
			map.fitBounds([
    			[properties.y1, properties.x1],
    			[properties.y2, properties.x2]
			]);
			
			watershedHUC6.setFeatureStyle(properties.TNMID, style);
		});
	});
    
///////////////////////HUC8 (local) scale////////////////////////////////	    
    var highlight;
    var click;
    var vectorSelection;
	var clearHighlight = function() {
		if (highlight != click) {
			watershedHUC8.resetFeatureStyle(highlight);
		}
		highlight = null;
	};
	var clearClick = function() {
		if (click) {
			watershedHUC8.resetFeatureStyle(click);
		}
		click = null;
	};
	
    var watershedHUC8 = $.getJSON("http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_PNW_ATLAS:watershed_HU8&maxFeatures=500&outputFormat=application%2Fjson", function(data){
    watershedHUC8 = L.vectorGrid.slicer(data, {
			rendererFactory: L.svg.tile,
			vectorTileLayerStyles: {
				sliced: function(properties, zoom) {
					return {
						fillColor:'#cce0ff',
						fillOpacity: 0.5,
						stroke: true,
						fill: true,
						color: '#1a75ff', 							
						opacity: 0.5,
						weight: 1,
						dashArray:4
					}
				}
			},
			interactive: true,
			getFeatureId: function(f) {
				return f.properties.TNMID;
			}
		})
		.on('mouseover', function(e) {
			var properties = e.layer.properties;
			
			clearHighlight();
			highlight = properties.TNMID;

			var style = {
				fillColor:'#cce0ff',
				fillOpacity: 0.9,
				stroke: true,
				fill: true,
				color: '#1a75ff', 							
				opacity: 0.5,
				weight: 1,
			};
			
			watershedHUC8.setFeatureStyle(properties.TNMID, style);
		})
		.on('click', function(e) {
			var properties = e.layer.properties;
			
			info.addTo(map);
			
			clearClick();
			highlight = null;
			click = properties.TNMID;
			clickID = properties.HUC8;
						
			var style = {
				fillColor:'#cce0ff',
				fillOpacity: 0.9,
				stroke: true,
				fill: true,
				color: '#1a75ff', 							
				opacity: 0.5,
				weight: 1,
			};
			
			if (vectorSelection != null){
		    	map.removeLayer(damsHUC8);
		   		map.removeLayer(riversHUC8);
		   		map.removeLayer(cities);
		   		map.removeLayer(lakesHUC8);
		   		map.removeLayer(reservations);
		   	}
				
			vectorSelection = 1;
			layers = 1;
			
			
			
			addReservations();
			addCities();
			$.when(cities).done(function(){
				addLakesHUC8();
				addRiversHUC8();
				$.when(riversHUC8).done(function(){
					addDamsHUC8();
				});
			});
			
			
			document.getElementById('title').innerHTML = properties.Name;
			document.getElementById('area').innerHTML = properties.area_sqmi + '&nbspSq. Mi.';
			document.getElementById('dams').innerHTML = properties.dams_total;
			document.getElementById('population').innerHTML = properties.POPULATION;
			document.getElementById('cities').innerHTML = properties.cities_001;
			document.getElementById('states').innerHTML = properties.States;
			document.getElementById('counties').innerHTML = properties.counties;
			
			map.fitBounds([
    			[properties.y1, properties.x1],
    			[properties.y2, properties.x2]
			]);
			
			
			watershedHUC8.setFeatureStyle(properties.TNMID, style);
		});
	});
    
///////////////////////tooltip info////////////////////////////////
 
 	function whichText(props){
		return hoverSelection == 0 ? '<h3 style="margin:0; display:inline-block;">' +  props.NAME + '</h3>' :
			hoverSelection ==1 ?'<h3 style="margin:0; display:inline-block;">' +  props.NAME + '</h3>' :
				'<h3 style="display:inline;">' + props.NAME + '</h3><br/><p style="display:inline;">Height:&nbsp' + props.HEIGHT + '&nbspft.<br/>Storage:&nbsp' + props.STORAGE + '&nbspacre ft.<br/>Year Completed:&nbsp' + props.YEAR + '</p>';
	}
  
///////////////////////dams geoJson styling////////////////////////////////

		//used with hoverSelection to determine correct data to display

	function damHighlight(e) {
		 var layer = e.target;
		 layer.setStyle({
        	fillColor: '#ffffff'
    	 });
    	 hoverSelection = 2;
		}
	//reset feature function (after highlight)
	function resetDamHighlight(e) {
		var layer = e.target;
		 layer.setStyle({
			fillColor: damColor(layer.feature.properties.HAZARD)
    	 });
	}

	function damSize(e){
		return e > 300 ? 7:
			e > 200 ? 5:
			e > 100 ? 3:
			e > 25 ? 2:
				1; 
	}
	
	function damColor(e){
		return e == 'H' ? '#ff0000':
			e == 'S' ? '#ffff99':
				'#33cc33'; 
	}

    function addDams(){
    	dams = $.getJSON("http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_PNW_ATLAS:national_dams&maxFeatures=1000&outputFormat=application%2Fjson", function(data){
        	dams = L.geoJson(data, {
        		pointToLayer: function (feature, latlng) {
    			return L.circleMarker(latlng, {
    				color: '#ffffff',
    				fillColor: damColor(feature.properties.HAZARD),
    				radius: damSize(feature.properties.HEIGHT),
    				opacity: 1,
    				fillOpacity: 1,
    				weight: 0.5
    				})
    			},
    			onEachFeature: function(feature, featureLayer) {
        			featureLayer.bindTooltip('<h3 style="display:inline;">' + feature.properties.NAME + '</h3><br/><p style="display:inline;">Height:&nbsp' + feature.properties.HEIGHT + '&nbspft.<br/>Storage:&nbsp' + feature.properties.STORAGE + '&nbspacre ft.<br/>Year Completed:&nbsp' + feature.properties.YEAR + '</p>', {className: 'label_tooltip', pane:'tooltip'});
        			featureLayer.on({
        				mouseover: damHighlight,
        				mouseout: resetDamHighlight,
        				click: damHighlight
   					});
        		},
    			filter:lakeFilter
        	}).addTo(map);
    	});

    }
    //for HUC8 scale
    function damSizeHUC8(e){
		return e > 300 ? 8:
			e > 200 ? 6.5:
			e > 100 ? 5:
			e > 25 ? 3.5:
				2;
		}
    
    function addDamsHUC8(){
    	damsHUC8 = $.getJSON("http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_PNW_ATLAS:total_dams&maxFeatures=2000&outputFormat=application%2Fjson", function(data){
        	damsHUC8 = L.geoJson(data, {
        		pointToLayer: function (feature, latlng) {
    			return L.circleMarker(latlng, {
    				color: '#ffffff',
    				fillColor: damColor(feature.properties.HAZARD),
    				radius: damSizeHUC8(feature.properties.HEIGHT),
    				opacity: 1,
    				fillOpacity: 1,
    				weight: 0.5
    				})
    			},
    			onEachFeature: function(feature, featureLayer) {
    				featureLayer.bindTooltip('<h3 style="display:inline;">' + feature.properties.NAME + '</h3><br/><p style="display:inline;">Height:&nbsp' + feature.properties.HEIGHT + '&nbspft.<br/>Storage:&nbsp' + feature.properties.STORAGE + '&nbspacre ft.<br/>Year Completed:&nbsp' + feature.properties.YEAR + '</p>', {className: 'label_tooltip', pane:'tooltip'});
        			featureLayer.on({
        				mouseover: damHighlight,
        				mouseout: resetDamHighlight,
        				click: damHighlight
   					});
        		},
    			filter:lakeFilterHUC8
    		}).addTo(map);
    	});

    }
    
///////////////////////cities geoJson styling////////////////////////////////

    function cityStyle(feature){
    	return {
            	fillColor: '#d9d9d9	',
            	fillOpacity:0.8,
            	weight: 1,
            	opacity: 0.8,
            	color: '#d9d9d9'
        	};
    	}
    
    function addCities(){
    	cities = $.getJSON("http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_PNW_ATLAS:watershed_city_areas&maxFeatures=1000&outputFormat=application%2Fjson", function(data){
        	cities = L.geoJson(data, {
        		style:cityStyle,
    			filter:lakeFilter
        	}).addTo(map).bringToBack();
    	});
    }
///////////////////////reservations geoJson styling////////////////////////////////    
    function reservationStyle(feature){
    	return {
            	fillColor: '#ededdc',
            	fillOpacity:0.8,
            	weight: 1,
            	opacity: 0.8,
            	color: '#ededdc'
        	};
    	}
    
    function addReservations(){
    	reservations = $.getJSON("http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_PNW_ATLAS:watershed_reservations&maxFeatures=100&outputFormat=application%2Fjson", function(data){
        	reservations = L.geoJson(data, {
        		style:reservationStyle,
    			filter:lakeFilter
        	}).addTo(map).bringToBack();
    	});

    }

    
///////////////////////rivers geoJson styling////////////////////////////////
    
     function riverHighlight(e) {
		 var layer = e.target;
		 	layer.setStyle({
        		opacity: 0.4,
        		color:'#ffffff',
        		weight:3
    	 		});
    	 	hoverSelection = 1;
	}
	//reset feature function (after highlight)
	function resetRiverHighlight(e) {
		var layer = e.target;
		layer.setStyle({
        		opacity: 1,
        		color:riverColor(layer.feature.properties.FEATURE),
        		weight: riverSize(layer.feature.properties.level)
    	 	});
	}
    
    
    function riverSize(e){
        return e == 1 ? 2.25 :
        	   e == 2 ? 1.75 :
        	   e == 3 ? 1.25 :
        	   e == 4 ? 0.75 :
        		0.5;
    	}   
    	
    function riverColor(string){
        return string == 'Canal' ? '#00cc99' :
        		'#80bfff';
    	}  
    	
    function riverDash(string){
        return string == 'Stream Intermittent' ? '4' :
        		0;
    	}  
    	
    function riverStyle(feature){
	return{
		opacity: 1,
		color:riverColor(feature.properties.FEATURE),
		weight: riverSize(feature.properties.level),
		dashArray: riverDash(feature.properties.FEATURE)
		};
	}
    
    function addRivers(){
    	rivers = $.getJSON("http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_PNW_ATLAS:watershed_rivers&maxFeatures=5000&outputFormat=application%2Fjson", function(data){
        	rivers = L.geoJson(data, {
        		style:riverStyle,
        		onEachFeature: function(feature, featureLayer) {
        			featureLayer.bindTooltip('<h3 style="margin:0; display:inline-block;">' +  feature.properties.NAME + '</h3>', {className: 'label_tooltip', pane:'tooltip'});
        			featureLayer.on({
        				mouseover: riverHighlight,
        				mouseout: resetRiverHighlight,
        				click: riverHighlight
   					});
        		},
        		filter: lakeFilter
        	}).addTo(map);
    	});
    }
    function addRiversHUC8(){
    	riversHUC8 = $.getJSON("http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_PNW_ATLAS:watershed_rivers_HUC8&maxFeatures=10000&outputFormat=application%2Fjson", function(data){
        	riversHUC8 = L.geoJson(data, {
        		style:riverStyle,
        		onEachFeature: function(feature, featureLayer) {
        			featureLayer.bindTooltip('<h3 style="margin:0; display:inline-block;">' +  feature.properties.NAME + '</h3>', {className: 'label_tooltip', pane:'tooltip'});
        			featureLayer.on({
        				mouseover: riverHighlight,
        				mouseout: resetRiverHighlight,
        				click: riverHighlight
   					});
        		},
        		filter: lakeFilterHUC8
        	}).addTo(map);
    	});
    }
    
///////////////////////lakes geoJson styling////////////////////////////////
   
    function lakeHighlight(e) {
		 var layer = e.target;
		 	layer.setStyle({
        		fillOpacity: 0.4,
        		opacity: 0.4,
        		fillColor:'#ffffff',
        		color:'#ffffff'
    	 		});
    	 	hoverSelection = 0;
	}
	//reset feature function (after highlight)
	function resetLakeHighlight(e) {
		var layer = e.target;
		layer.setStyle({
        		fillOpacity: 1,
        		opacity: 1,
        		fillColor:lakeColor(layer.feature.properties.FEATURE),
        		color:lakeColor(layer.feature.properties.FEATURE)
    	 	});
	}
    
    function lakeColor(string){
        return string == 'Lake Intermittent' ? '#b3daff' :
        		'#80bfff';
    	}  
    
    function lakeStyle(feature){
	return{
		opacity: 1,
		fillOpacity: 1,
		color:lakeColor(feature.properties.FEATURE),
		fillColor:lakeColor(feature.properties.FEATURE),
		weight:0.5
		};
	}
	
	function lakeFilter(feature) {
			if (scale == 0){
        		if (feature.properties.HUC4 == clickID)return true 
        	}
        	else if (scale == 1) {
        		if (feature.properties.HUC6 == clickID)return true 
        	} 
        	else {
        		if (feature.properties.HUC8 == clickID)return true 
        	}
    	}
    	
  function lakeFilterHUC8(feature) {
        		if (feature.properties.HUC8 == clickID)return true
    	}
    
    function addLakes(){
    	lakes = $.getJSON("http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_PNW_ATLAS:watershed_lakes&maxFeatures=1000&outputFormat=application%2Fjson", function(data){
        	lakes = L.geoJson(data, {
        		style:lakeStyle,
        		onEachFeature: function(feature, featureLayer) {
        			featureLayer.bindTooltip('<h3 style="margin:0; display:inline-block;">' +  feature.properties.NAME + '</h3>', {className: 'label_tooltip', pane:'tooltip'});
        			featureLayer.on({
        				mouseover: lakeHighlight,
        				mouseout: resetLakeHighlight,
        				click: lakeHighlight
   					});
        		},
        		filter: lakeFilter
        	}).addTo(map);
    	});
    }
    
    function addLakesHUC8(){
    	lakesHUC8 = $.getJSON("http://mapious.ceoas.oregonstate.edu/geoserver/baldricg_PNW_ATLAS/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=baldricg_PNW_ATLAS:watershed_lakes_HUC8&maxFeatures=10000&outputFormat=application%2Fjson", function(data){
        	lakesHUC8 = L.geoJson(data, {
        		style:lakeStyle,
        		onEachFeature: function(feature, featureLayer) {
        			featureLayer.bindTooltip('<h3 style="margin:0; display:inline-block;">' +  feature.properties.NAME + '</h3>', {className: 'label_tooltip', pane:'tooltip'});
        			featureLayer.on({
        				mouseover: lakeHighlight,
        				mouseout: resetLakeHighlight,
        				click: lakeHighlight
   					});
        		},
        		filter: lakeFilter
        	}).addTo(map);
    	});
    }
    

////////////////////////////////////////////////////////////////////////////////////////////

function HUC4(){
	removeLayers();
	document.getElementById('but1').style.background = "rgba(242, 242, 242, 0.9)";
	document.getElementById('but2').style.background = "rgba(242,242,242,0.2)";
	document.getElementById('but3').style.background = "rgba(242,242,242,0.2)";
	document.getElementById('dams_title').innerHTML = 'Large Dams<sup class="tooltip">?<span class="tooltiptext">Dams higher than 50 ft. or capacity greater than 5000 acre ft.</span></sup>:';
	watershedHUC4.addTo(map);
	clearClickHUC4();
	scale=0;
}

function HUC6(){
	removeLayers();
	document.getElementById('but1').style.background = "rgba(242,242,242,0.2)";
	document.getElementById('but2').style.background = "rgba(242, 242, 242, 0.9)";
	document.getElementById('but3').style.background = "rgba(242,242,242,0.2)";
	document.getElementById('dams_title').innerHTML = 'Large Dams<sup class="tooltip">?<span class="tooltiptext">Dams higher than 50 ft. or capacity greater than 5000 acre ft.</span></sup>:';
	watershedHUC6.addTo(map);
	clearClickHUC6();
	scale=1;
}

function HUC8(){
	removeLayers();
	document.getElementById('but1').style.background = "rgba(242,242,242,0.2)";
	document.getElementById('but2').style.background = "rgba(242,242,242,0.2)";
	document.getElementById('but3').style.background = "rgba(242, 242, 242, 0.9)";
	document.getElementById('dams_title').innerHTML = 'Dams<sup class="tooltip">?<span class="tooltiptext">Dams higher than 10 ft. or capacity greater than 1000 acre ft.</span></sup>:';
	watershedHUC8.addTo(map);
	clearClick();
	scale=2;
}

function removeLayers(){
	if (layers == 1){
		if (scale == 2){
			map.removeLayer(damsHUC8);
			map.removeLayer(cities);
			map.removeLayer(reservations);
			map.removeLayer(riversHUC8);
			map.removeLayer(lakesHUC8);
			map.removeLayer(watershedHUC8);
		}
		else if (scale == 1){
			map.removeLayer(dams);
			map.removeLayer(cities);
			map.removeLayer(reservations);
			map.removeLayer(rivers);
			map.removeLayer(lakes);
			map.removeLayer(watershedHUC6);
		}
		else if (scale == 0){
			map.removeLayer(dams);
			map.removeLayer(cities);
			map.removeLayer(reservations);
			map.removeLayer(rivers);
			map.removeLayer(lakes);
			map.removeLayer(watershedHUC4);
		}
	} else {
		if (scale == 2){
			map.removeLayer(watershedHUC8);
		}
		else if (scale == 0){
			map.removeLayer(watershedHUC4);
		}
		else {
			map.removeLayer(watershedHUC6);
		}
	}
	document.getElementById('title').innerHTML = 'Select a Watershed';
	document.getElementById('area').innerHTML = '';
	document.getElementById('dams').innerHTML = '';
	document.getElementById('population').innerHTML = '';
	document.getElementById('cities').innerHTML = '';
	document.getElementById('states').innerHTML = '';
	document.getElementById('counties').innerHTML = '';
	
  	map.removeControl(info);
}
//////////////////////////////////////border toggle/////////////////////////////////////////////////
 function pnwStatesStyle(){
	return{
		opacity: 1,
		color:'#666666',
		fillOpacity:0	,
		fillColor:'#404040',
		weight:1.5
		};
	}
     var pnwStates = $.getJSON("assets/pnw_states.geojson", function(data){
        pnwStates = L.geoJson(data, {
        	style:pnwStatesStyle,
        	interactive: false
        });
    });
    
     var pnwCounties = $.getJSON("assets/counties2.geojson", function(data){
        pnwCounties = L.geoJson(data, {
        	style: function pnwCountiesStyle(){
				return{
					opacity: 0.7,
					color:'#999999',
					weight:0.5
				};
			},
			interactive: false
        });
    });
    
    function borders() {
    	if (border == 0){
    		border = 1;
    		pnwStates.addTo(map);
    		pnwCounties.addTo(map);
    	}
    	else {
    		border = 0;
    		map.removeLayer(pnwStates);
    		map.removeLayer(pnwCounties);
    	}
    } 

////////////////////////////////////////////////////////////////////////////////////////////


    new L.Control.Zoom({ position: 'bottomright' }).addTo(map);
	document.getElementsByClassName("leaflet-control-attribution")[0].style.visibility = "hidden";
	//add scrolling capabilities to text box
     var container = document.getElementById('text');
		Ps.initialize(container);
	
	var minHeight = 30; // Define a minimum height for the middle div

	var resizeMiddle = function() {
    var h = $('body').height() - $('#top').height() - 80;
    		h = h > minHeight ? h : minHeight;
   	 	$('#attribution').height(h);
	}

	$(document).ready(resizeMiddle);
	$(window).resize(resizeMiddle);
	
	
    //remove standard leaflet attribution
    

</script>
</body>
</html>
